/*
 MIT
 @author Alexander Milevski <info@w8r.name>
 @preserve
*/
(function(x){if("object"===typeof exports&&"undefined"!==typeof module)module.exports=x();else if("function"===typeof define&&define.na)define([],x);else{var k;k="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this;k=k.L||(k.L={});k=k.Control||(k.Control={});k.LineStringSelect=x()}})(function(){return function k(n,m,f){function g(h,u){if(!m[h]){if(!n[h]){var t="function"==typeof require&&require;if(!u&&t)return t(h,!0);if(r)return r(h,!0);t=Error("Cannot find module '"+
h+"'");throw t.code="MODULE_NOT_FOUND",t;}t=m[h]={exports:{}};n[h][0].call(t.exports,function(a){var b=n[h][1][a];return g(b?b:a)},t,t.exports,k,n,m,f)}return m[h].exports}for(var r="function"==typeof require&&require,h=0;h<f.length;h++)g(f[h]);return g}({1:[function(k,n){(("undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{}).L||k("leaflet")).Control.LineStringSelect=n.exports=k("./src/select")},{"./src/select":6,leaflet:void 0}],2:[function(k,n){(function(){function m(d,
c){if(!(this instanceof m))return new m(d,c);this.o=Math.max(4,d||9);this.I=Math.max(2,Math.ceil(.4*this.o));c&&this.ea(c);this.clear()}function f(d,c){d.a=g(d,0,d.children.length,c)}function g(d,c,a,b){for(var f=[Infinity,Infinity,-Infinity,-Infinity],e;c<a;c++)e=d.children[c],r(f,d.b?b(e):e.a);return f}function r(d,c){d[0]=Math.min(d[0],c[0]);d[1]=Math.min(d[1],c[1]);d[2]=Math.max(d[2],c[2]);d[3]=Math.max(d[3],c[3])}function h(d,c){return d.a[0]-c.a[0]}function k(d,c){return d.a[1]-c.a[1]}function u(d){return(d[2]-
d[0])*(d[3]-d[1])}function t(d){return d[2]-d[0]+(d[3]-d[1])}function a(d,c){return d[0]<=c[0]&&d[1]<=c[1]&&c[2]<=d[2]&&c[3]<=d[3]}function b(d,c){return c[0]<=d[2]&&c[1]<=d[3]&&c[2]>=d[0]&&c[3]>=d[1]}function e(d,c,a,b,e){for(var f=[c,a],p;f.length;)a=f.pop(),c=f.pop(),a-c<=b||(p=c+Math.ceil((a-c)/b/2)*b,q(d,c,a,p,e),f.push(c,p,p,a))}function q(d,c,a,b,f){for(var e,p,g,l,h;a>c;){600<a-c&&(e=a-c+1,p=b-c+1,g=Math.log(e),l=.5*Math.exp(2*g/3),h=.5*Math.sqrt(g*l*(e-l)/e)*(0>p-e/2?-1:1),g=Math.max(c,Math.floor(b-
p*l/e+h)),p=Math.min(a,Math.floor(b+(e-p)*l/e+h)),q(d,g,p,b,f));e=d[b];p=c;l=a;v(d,c,b);for(0<f(d[a],e)&&v(d,c,a);p<l;){v(d,p,l);p++;for(l--;0>f(d[p],e);)p++;for(;0<f(d[l],e);)l--}0===f(d[c],e)?v(d,c,l):(l++,v(d,l,a));l<=b&&(c=l+1);b<=l&&(a=l-1)}}function v(d,c,a){var b=d[c];d[c]=d[a];d[a]=b}m.prototype={all:function(){return this.A(this.data,[])},search:function(d){var c=this.data,e=[],f=this.f;if(!b(d,c.a))return e;for(var g=[],h,p,w,l;c;){h=0;for(p=c.children.length;h<p;h++)w=c.children[h],l=c.b?
f(w):w.a,b(d,l)&&(c.b?e.push(w):a(d,l)?this.A(w,e):g.push(w));c=g.pop()}return e},load:function(d){if(!d||!d.length)return this;if(d.length<this.I){for(var c=0,a=d.length;c<a;c++)this.ja(d[c]);return this}d=this.C(d.slice(),0,d.length-1,0);this.data.children.length?this.data.height===d.height?this.S(this.data,d):(this.data.height<d.height&&(c=this.data,this.data=d,d=c),this.H(d,this.data.height-d.height-1,!0)):this.data=d;return this},ja:function(d){d&&this.H(d,this.data.height-1);return this},clear:function(){this.data=
{children:[],height:1,a:[Infinity,Infinity,-Infinity,-Infinity],b:!0};return this},remove:function(d){if(!d)return this;for(var c=this.data,b=this.f(d),e=[],f=[],g,p,h,l;c||e.length;){c||(c=e.pop(),p=e[e.length-1],g=f.pop(),l=!0);if(c.b&&(h=c.children.indexOf(d),-1!==h)){c.children.splice(h,1);e.push(c);this.ba(e);break}l||c.b||!a(c.a,b)?p?(g++,c=p.children[g],l=!1):c=null:(e.push(c),f.push(g),g=0,p=c,c=c.children[0])}return this},f:function(d){return d},v:function(d,c){return d[0]-c[0]},w:function(d,
c){return d[1]-c[1]},toJSON:function(){return this.data},A:function(d,c){for(var a=[];d;)d.b?c.push.apply(c,d.children):a.push.apply(a,d.children),d=a.pop();return c},C:function(d,c,a,b){var g=a-c+1,h=this.o,p;if(g<=h)return p={children:d.slice(c,a+1),height:1,a:null,b:!0},f(p,this.f),p;b||(b=Math.ceil(Math.log(g)/Math.log(h)),h=Math.ceil(g/Math.pow(h,b-1)));p={children:[],height:b,a:null};var g=Math.ceil(g/h),h=g*Math.ceil(Math.sqrt(h)),q,l,r;for(e(d,c,a,h,this.v);c<=a;c+=h)for(l=Math.min(c+h-1,
a),e(d,c,l,g,this.w),q=c;q<=l;q+=g)r=Math.min(q+g-1,l),p.children.push(this.C(d,q,r,b-1));f(p,this.f);return p},aa:function(d,c,a,b){for(var e,f,g,h,l,q,r,m;;){b.push(c);if(c.b||b.length-1===a)break;r=m=Infinity;e=0;for(f=c.children.length;e<f;e++){g=c.children[e];l=u(g.a);q=d;var k=g.a;q=(Math.max(k[2],q[2])-Math.min(k[0],q[0]))*(Math.max(k[3],q[3])-Math.min(k[1],q[1]))-l;q<m?(m=q,r=l<r?l:r,h=g):q===m&&l<r&&(r=l,h=g)}c=h}return c},H:function(d,c,a){var b=this.f;a=a?d.a:b(d);var b=[],e=this.aa(a,
this.data,c,b);e.children.push(d);for(r(e.a,a);0<=c;)if(b[c].children.length>this.o)this.ia(b,c),c--;else break;this.W(a,b,c)},ia:function(d,a){var b=d[a],e=b.children.length,g=this.I;this.Z(b,g,e);e={children:b.children.splice(this.$(b,g,e)),height:b.height};b.b&&(e.b=!0);f(b,this.f);f(e,this.f);a?d[a-1].children.push(e):this.S(b,e)},S:function(d,a){this.data={children:[d,a],height:d.height+1};f(this.data,this.f)},$:function(d,a,b){var e,f,h,q,r,l,m;r=l=Infinity;for(e=a;e<=b-a;e++){f=g(d,0,e,this.f);
h=g(d,e,b,this.f);var k=f,n=h;q=Math.max(k[0],n[0]);var v=Math.max(k[1],n[1]),t=Math.min(k[2],n[2]),k=Math.min(k[3],n[3]);q=Math.max(0,t-q)*Math.max(0,k-v);f=u(f)+u(h);q<r?(r=q,m=e,l=f<l?f:l):q===r&&f<l&&(l=f,m=e)}return m},Z:function(a,c,b){var e=a.b?this.v:h,f=a.b?this.w:k,g=this.B(a,c,b,e);c=this.B(a,c,b,f);g<c&&a.children.sort(e)},B:function(a,c,b,e){a.children.sort(e);e=this.f;var f=g(a,0,c,e),h=g(a,b-c,b,e),q=t(f)+t(h),k,l;for(k=c;k<b-c;k++)l=a.children[k],r(f,a.b?e(l):l.a),q+=t(f);for(k=b-
c-1;k>=c;k--)l=a.children[k],r(h,a.b?e(l):l.a),q+=t(h);return q},W:function(a,c,b){for(;0<=b;b--)r(c[b].a,a)},ba:function(a){for(var c=a.length-1,b;0<=c;c--)0===a[c].children.length?0<c?(b=a[c-1].children,b.splice(b.indexOf(a[c]),1)):this.clear():f(a[c],this.f)},ea:function(a){var b=["return a"," - b",";"];this.v=new Function("a","b",b.join(a[0]));this.w=new Function("a","b",b.join(a[1]));this.f=new Function("a","return [a"+a.join(", a")+"];")}};"undefined"!==typeof n?n.exports=m:"undefined"!==typeof self?
self.V=m:window.V=m})()},{}],3:[function(k,n){var m=k("./marker"),f=m.extend({options:{radiusRatio:1.2},onAdd:function(f){this.on("mouseover",this.O,this).on("mouseout",this.N,this);m.prototype.onAdd.call(this,f)},onRemove:function(f){this.off("mouseover",this.O,this).off("mouseout",this.N,this);m.prototype.onRemove.call(this,f)},O:function(){this.setRadius(this.options.radius*this.options.radiusRatio)},N:function(){this.setRadius(this.options.radius/this.options.radiusRatio)}});n.exports=f},{"./marker":5}],
4:[function(k,n){function m(f,g){var k=f[0]-g[0],h=f[1]-g[1];return k*k+h*h}n.exports={la:function(f,g,k){var h=k[0]-g[0],n=k[1]-g[1],u=h*h+n*n,u=u&&((f[0]-g[0])*h+(f[1]-g[1])*(k[1]-g[1]))/u;return m(f,0>=u?g:1<=u?k:[g[0]+u*h,g[1]+u*n])},closestPointOnSegment:function(f,g,k){var h=k[0]-g[0],m=k[1]-g[1];f=((f[0]-g[0])*h+(f[1]-g[1])*m)/(h*h+m*m);f=0>f?0:1<f?1:f;return[g[0]+f*(k[0]-g[0]),g[1]+f*(k[1]-g[1])]},ka:function(f,g,k,h){k/=h;h=f[0];f=f[1];return[h+k*(g[0]-h),f+k*(g[1]-f)]},distance:function(f,
g){return Math.sqrt(m(f,g))}}},{}],5:[function(k,n){(function(m){m=(m.L||k("leaflet")).CircleMarker.extend({show:function(){this._container.style.visibility="";return this},hide:function(){this._container.style.visibility="hidden";return this}});n.exports=m}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}],6:[function(k,n){(function(m){var f=m.L||k("leaflet"),g=k("./geometry"),r=k("./marker"),h=k("./endpoint"),y=
k("./selection"),u=m.V||k("rbush"),t=f.Control.extend({includes:f.Mixin.Events,statics:{Selection:y,Endpoint:h,ControlMarker:r},options:{startMarkerClass:"select-marker select-start-marker",endMarkerClass:"select-marker select-end-marker",movingMarkerClass:"select-marker select-moving-marker",name:"leaflet-linestring-select",lineWeight:4,lineTolerance:f.Browser.touch?10:5,movingMarkerStyle:{fillColor:"#fff",fillOpacity:1,weight:2,opacity:.5,color:"#000"},endpointStyle:{radius:5,color:"#111",fillColor:"#fff",
fillOpacity:1},selectionStyle:{color:"#0ff",opacity:1},useTouch:f.Browser.touch,position:"topright"},initialize:function(a){a=a||{};this.u=this.g=this.h=this._feature=this._movingMarker=this._endMarker=this._startMarker=null;f.Util.setOptions(this,a);f.Control.prototype.initialize.call(this,this.options)},onAdd:function(){var a=this._container=f.DomUtil.create("div",this.options.oa);f.DomEvent.disableClickPropagation(a).disableScrollPropagation(a);return a},onRemove:function(){this.disable()},enable:function(a){this.h=
a.layer;this._feature=a.feature||a.layer.toGeoJSON();this.ca();this.X();this.h.on("click",this.J,this);this._map.on("moveend zoomend resize",this.m,this).on("mousemove touchmove",this.P,this).on(f.Draggable.START.join(" "),this.M,this).on("click contextmenu",this.K,this);this.m();return this},disable:function(){this.reset();this._map.removeLayer(this._movingMarker);this._movingMarker=null;this.h.off("click",this.J,this);this._map.off("moveend zoomend resize",this.m,this).off("mousemove touchmove",
this.P,this).off(f.Draggable.START.join(" "),this.M,this).off("click contextmenu",this.K,this);this.h=this._feature=null;return this},reset:function(){this._startMarker&&(this._map.removeLayer(this._startMarker),this._startMarker=null);this._endMarker&&(this._map.removeLayer(this._endMarker),this._endMarker=null);this.g&&(this._map.removeLayer(this.g),this.g=null);this._movingMarker.setLatLng(this.h.getLatLngs()[0]);this.options.useTouch||this._movingMarker.show();this.fire("reset");return this},
getSelection:function(){return this.g?this.g.getLatLngs():null},toGeoJSON:function(){return this.g?this.g.toGeoJSON():null},selectMeters:function(a,b){this.reset();if(0>a||0>b)throw Error("Can't use negative meter values for distance selection");var e=this.R(a),f=this.R(b),e=this.i(e),f=this.i(f);this.j(e,e.start,e.end);this.j(f,f.start,f.end);return this},movingMarkerFactory:function(a,b){return new r(a,b)},endpointFactory:function(a,b){return new h(a,b)},selectionFactory:function(a,b,e){return new y(a,
b,e)},D:function(a,b){return this.options.distance?this.options.distance(a,b):(new f.LatLng(a[1],a[0])).distanceTo(new f.LatLng(b[1],b[0]))},G:function(a){if(this.options.getProjectedPoint)return this.options.getProjectedPoint.call(this,a);a=this._map.options.crs.latLngToPoint(new f.LatLng(a[1],a[0]),this._map.getMaxZoom());return[a.x,a.y]},ha:function(a,b,e){var h=this.D(a,b);a=this.G(a);b=this.G(b);a=g.ka(a,b,e,h);return f.point(a)},R:function(a){for(var b=this._feature.geometry.coordinates,e=0,
g=1,h=b.length;g<h;g++){var d=this.D(b[g-1],b[g]);if(e+d<=a)e+=d;else break}if(e===a||g===b.length)return a=b[g-1],new f.LatLng(a[1],a[0]);a=this.ha(b[g-1],b[g],a-e);return this._map.options.crs.pointToLatLng(a,this._map.getMaxZoom())},m:function(){var a=this._map.getCenter(),b=.5*this.options.lineWeight+this.options.lineTolerance,b=this._map.layerPointToLatLng(this._map.latLngToLayerPoint(a).add(new f.Point(b,b)));this.u=new f.LatLng(Math.abs(a.lat-b.lat),Math.abs(a.lng-b.lng))},ca:function(){var a=
f.latLng(this.h._latlngs[0]),b=this.options.movingMarkerStyle;b.radius=this.options.lineTolerance;b.className=this.options.movingMarkerClass;this._movingMarker=this.movingMarkerFactory(a,b).addTo(this._map);this._movingMarker.on("click",this.ga,this);this.options.useTouch&&this._movingMarker.hide()},ga:function(){this.j(this._movingMarker.getLatLng(),this._movingMarker.start,this._movingMarker.end)},J:function(a){var b=this.i(a.latlng);b?this.j(f.latLng(b),b.start,b.end):this.j(a.latlng)},K:function(a){if(!this._endMarker){var b=
this._map.latLngToLayerPoint(a.latlng),e=this._movingMarker.getLatLng();this.options.useTouch&&(a=this.i(a.latlng))&&(e=f.latLng(a),this._movingMarker.setLatLng(e));a=this._map.latLngToLayerPoint(e);g.distance([b.x,b.y],[a.x,a.y])<=2*this.options.lineTolerance&&(e=this.i(e),this.j(e,e.start,e.end))}},j:function(a,b,e){var f=this.options.endpointStyle;this._startMarker?this._endMarker||(f.className=this.options.endMarkerClass,this._endMarker=this.endpointFactory(a,f,!0).addTo(this._map),this._endMarker.start=
b,this._endMarker.end=e,this._movingMarker.hide(),this.fire("select:end",{latlng:a}),this._startMarker&&this._endMarker&&this.s()):(f.className=this.options.startMarkerClass,this._startMarker=this.endpointFactory(a,f,!1).addTo(this._map),this._startMarker.start=b,this._startMarker.end=e,this.fire("select:start",{latlng:a}))},da:function(a){var b=this.u.lng,e=this.u.lat;return[[a.lat-e,a.lng-b],[a.lat+e,a.lng+b]]},M:function(a){var b=a.originalEvent.target||a.originalEvent.srcElement;if(this.options.useTouch){var e;
this._startMarker&&(e=this._map.latLngToContainerPoint(this._startMarker.getLatLng()),g.distance([a.containerPoint.x,a.containerPoint.y],[e.x,e.y])<=2*this.options.lineTolerance&&(b=this._startMarker._path));this._endMarker&&(e=this._map.latLngToContainerPoint(this._endMarker.getLatLng()),g.distance([a.containerPoint.x,a.containerPoint.y],[e.x,e.y])<=2*this.options.lineTolerance&&(b=this._endMarker._path))}this._startMarker&&this._startMarker._path===b?this.c=this._startMarker:this._endMarker&&this._endMarker._path===
b&&(this.c=this._endMarker);this.c&&(f.DomEvent.stop(a),this.c.c=!0,f.Draggable._disabled=!0,this._map.dragging.disable(),this._map.once("mouseup",this.T,this))},T:function(a){this.c&&(m.clearTimeout(this.F),f.Draggable._disabled=!1,this._map.dragging.enable(),this.c=this.c.c=null,this.fa(this.c,a.latlng))},fa:function(){this._startMarker&&this._endMarker&&this.s()},Y:function(){if(this._startMarker.start>this._endMarker.start){var a=this._startMarker;this._startMarker=this._endMarker;this._endMarker=
a}},s:function(){this.Y();var a=this.h._latlngs.slice(this._startMarker.end,this._endMarker.start+1);a.unshift(this._startMarker.getLatLng());a.push(this._endMarker.getLatLng());this.g?(this.g._latlngs=a,this.g.ma(this._startMarker.end,this._endMarker.start)):(this.g=this.selectionFactory(a,this.options.selectionStyle,this.h).addTo(this._map),this._startMarker.bringToFront(),this._endMarker.bringToFront());this.fire("selection")},P:function(a){var b=this.i(a.latlng);this.c?(b&&(this.c.start=b.start,
this.c.end=b.end,this.c.setLatLng(b)),this._startMarker&&this._endMarker&&this.s(),m.clearTimeout(this.F),this.F=m.setTimeout(this.T.bind(this,a),750)):b&&(this._movingMarker.setLatLng(b),this._movingMarker.start=b.start,this._movingMarker.end=b.end)},i:function(a,b){var e=this.da(a,b),e=this.l.search(this.U(e[0].reverse(),e[1].reverse()));if(0!==e.length){var f=this._feature.geometry.coordinates,h=Number.MAX_VALUE,d=[a.lng,a.lat],c=e[0].start,k=e[0].end,m=f[c],r=f[k];if(1<e.length)for(var n=0,p=
e.length;n<p;n++){var t=f[e[n].start],l=f[e[n].end],u=g.la(d,t,l);u<h&&(h=u,m=t,r=l,c=e[n].start,k=e[n].end)}d=g.closestPointOnSegment(d,m,r);d=[d[1],d[0]];d.start=c;d.end=k;return d}return null},X:function(){var a=this._feature.geometry.coordinates,b=[];this.l?this.l.clear():this.l=u();for(var e=1,f=a.length;e<f;e++){var g=this.U(a[e-1],a[e]);g.start=e-1;g.end=e;b.push(g)}this.l.load(b)},U:function(a,b){var e=a[0],f=b[0],g=a[1],d=b[1];e>f&&(f=a[0],e=b[0]);g>d&&(d=a[1],g=b[1]);return[e,g,f,d]}});
n.exports=t}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./endpoint":3,"./geometry":4,"./marker":5,"./selection":7,leaflet:void 0,rbush:2}],7:[function(k,n){(function(m){var f=m.L||k("leaflet");m=f.Polyline.extend({initialize:function(g,k,h){this._source=h;f.Polyline.prototype.initialize.call(this,g,k)},ma:function(f,k){this._originalPoints=this._source._originalPoints.slice(f,k+1);this._originalPoints.unshift(this._map.latLngToLayerPoint(this._latlngs[0]));
this._originalPoints.push(this._map.latLngToLayerPoint(this._latlngs[this._latlngs.length-1]));this._updatePath()}});n.exports=m}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}]},{},[1])(1)});
