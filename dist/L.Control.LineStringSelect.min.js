/*
 MIT
 @author Alexander Milevski <info@w8r.name>
 @preserve
*/
function w(){return function n(q,k,e){function g(h,u){if(!k[h]){if(!q[h]){var t="function"==typeof require&&require;if(!u&&t)return t(h,!0);if(p)return p(h,!0);t=Error("Cannot find module '"+h+"'");throw t.code="MODULE_NOT_FOUND",t;}t=k[h]={exports:{}};q[h][0].call(t.exports,function(a){var b=q[h][1][a];return g(b?b:a)},t,t.exports,n,q,k,e)}return k[h].exports}for(var p="function"==typeof require&&require,h=0;h<e.length;h++)g(e[h]);return g}({1:[function(n,q){(("undefined"!==typeof global?global:
"undefined"!==typeof self?self:"undefined"!==typeof window?window:{}).L||n("leaflet")).Control.LineStringSelect=q.exports=n("./src/select")},{"./src/select":6,leaflet:void 0}],2:[function(n,q){(function(){function k(d,c){if(!(this instanceof k))return new k(d,c);this.k=Math.max(4,d||9);this.w=Math.max(2,Math.ceil(.4*this.k));c&&this.W(c);this.clear()}function e(d,c){d.a=g(d,0,d.children.length,c)}function g(d,c,a,b){for(var f=[Infinity,Infinity,-Infinity,-Infinity],l;c<a;c++)l=d.children[c],p(f,d.b?
b(l):l.a);return f}function p(d,c){d[0]=Math.min(d[0],c[0]);d[1]=Math.min(d[1],c[1]);d[2]=Math.max(d[2],c[2]);d[3]=Math.max(d[3],c[3])}function h(d,c){return d.a[0]-c.a[0]}function n(d,c){return d.a[1]-c.a[1]}function u(d){return(d[2]-d[0])*(d[3]-d[1])}function t(d){return d[2]-d[0]+(d[3]-d[1])}function a(d,c){return d[0]<=c[0]&&d[1]<=c[1]&&c[2]<=d[2]&&c[3]<=d[3]}function b(d,c){return c[0]<=d[2]&&c[1]<=d[3]&&c[2]>=d[0]&&c[3]>=d[1]}function f(d,c,a,b,f){for(var l=[c,a],e;l.length;)a=l.pop(),c=l.pop(),
a-c<=b||(e=c+Math.ceil((a-c)/b/2)*b,r(d,c,a,e,f),l.push(c,e,e,a))}function r(d,c,a,b,f){for(var l,e,g,m,h;a>c;){600<a-c&&(l=a-c+1,e=b-c+1,g=Math.log(l),m=.5*Math.exp(2*g/3),h=.5*Math.sqrt(g*m*(l-m)/l)*(0>e-l/2?-1:1),g=Math.max(c,Math.floor(b-e*m/l+h)),e=Math.min(a,Math.floor(b+(l-e)*m/l+h)),r(d,g,e,b,f));l=d[b];e=c;m=a;v(d,c,b);for(0<f(d[a],l)&&v(d,c,a);e<m;){v(d,e,m);e++;for(m--;0>f(d[e],l);)e++;for(;0<f(d[m],l);)m--}0===f(d[c],l)?v(d,c,m):(m++,v(d,m,a));m<=b&&(c=m+1);b<=m&&(a=m-1)}}function v(d,
c,a){var b=d[c];d[c]=d[a];d[a]=b}k.prototype={all:function(){return this.p(this.data,[])},search:function(d){var c=this.data,f=[],e=this.d;if(!b(d,c.a))return f;for(var g=[],l,h,x,m;c;){l=0;for(h=c.children.length;l<h;l++)x=c.children[l],m=c.b?e(x):x.a,b(d,m)&&(c.b?f.push(x):a(d,m)?this.p(x,f):g.push(x));c=g.pop()}return f},load:function(d){if(!d||!d.length)return this;if(d.length<this.w){for(var c=0,a=d.length;c<a;c++)this.aa(d[c]);return this}d=this.r(d.slice(),0,d.length-1,0);this.data.children.length?
this.data.height===d.height?this.I(this.data,d):(this.data.height<d.height&&(c=this.data,this.data=d,d=c),this.v(d,this.data.height-d.height-1,!0)):this.data=d;return this},aa:function(d){d&&this.v(d,this.data.height-1);return this},clear:function(){this.data={children:[],height:1,a:[Infinity,Infinity,-Infinity,-Infinity],b:!0};return this},remove:function(d){if(!d)return this;for(var c=this.data,b=this.d(d),f=[],e=[],l,g,h,m;c||f.length;){c||(c=f.pop(),g=f[f.length-1],l=e.pop(),m=!0);if(c.b&&(h=
c.children.indexOf(d),-1!==h)){c.children.splice(h,1);f.push(c);this.T(f);break}m||c.b||!a(c.a,b)?g?(l++,c=g.children[l],m=!1):c=null:(f.push(c),e.push(l),l=0,g=c,c=c.children[0])}return this},d:function(d){return d},n:function(d,c){return d[0]-c[0]},o:function(d,c){return d[1]-c[1]},toJSON:function(){return this.data},p:function(d,c){for(var a=[];d;)d.b?c.push.apply(c,d.children):a.push.apply(a,d.children),d=a.pop();return c},r:function(d,c,a,b){var g=a-c+1,l=this.k,h;if(g<=l)return h={children:d.slice(c,
a+1),height:1,a:null,b:!0},e(h,this.d),h;b||(b=Math.ceil(Math.log(g)/Math.log(l)),l=Math.ceil(g/Math.pow(l,b-1)));h={children:[],height:b,a:null};var g=Math.ceil(g/l),l=g*Math.ceil(Math.sqrt(l)),r,m,p;for(f(d,c,a,l,this.n);c<=a;c+=l)for(m=Math.min(c+l-1,a),f(d,c,m,g,this.o),r=c;r<=m;r+=g)p=Math.min(r+g-1,m),h.children.push(this.r(d,r,p,b-1));e(h,this.d);return h},S:function(d,c,a,b){for(var f,e,g,h,m,r,p,k;;){b.push(c);if(c.b||b.length-1===a)break;p=k=Infinity;f=0;for(e=c.children.length;f<e;f++){g=
c.children[f];m=u(g.a);r=d;var n=g.a;r=(Math.max(n[2],r[2])-Math.min(n[0],r[0]))*(Math.max(n[3],r[3])-Math.min(n[1],r[1]))-m;r<k?(k=r,p=m<p?m:p,h=g):r===k&&m<p&&(p=m,h=g)}c=h}return c},v:function(d,c,a){var b=this.d;a=a?d.a:b(d);var b=[],f=this.S(a,this.data,c,b);f.children.push(d);for(p(f.a,a);0<=c;)if(b[c].children.length>this.k)this.$(b,c),c--;else break;this.N(a,b,c)},$:function(d,a){var b=d[a],f=b.children.length,g=this.w;this.Q(b,g,f);f={children:b.children.splice(this.R(b,g,f)),height:b.height};
b.b&&(f.b=!0);e(b,this.d);e(f,this.d);a?d[a-1].children.push(f):this.I(b,f)},I:function(d,a){this.data={children:[d,a],height:d.height+1};e(this.data,this.d)},R:function(d,a,b){var f,e,l,h,r,m,p;r=m=Infinity;for(f=a;f<=b-a;f++){e=g(d,0,f,this.d);l=g(d,f,b,this.d);var k=e,n=l;h=Math.max(k[0],n[0]);var q=Math.max(k[1],n[1]),v=Math.min(k[2],n[2]),k=Math.min(k[3],n[3]);h=Math.max(0,v-h)*Math.max(0,k-q);e=u(e)+u(l);h<r?(r=h,p=f,m=e<m?e:m):h===r&&e<m&&(m=e,p=f)}return p},Q:function(a,c,b){var f=a.b?this.n:
h,e=a.b?this.o:n,g=this.q(a,c,b,f);c=this.q(a,c,b,e);g<c&&a.children.sort(f)},q:function(a,c,b,f){a.children.sort(f);f=this.d;var e=g(a,0,c,f),h=g(a,b-c,b,f),r=t(e)+t(h),k,m;for(k=c;k<b-c;k++)m=a.children[k],p(e,a.b?f(m):m.a),r+=t(e);for(k=b-c-1;k>=c;k--)m=a.children[k],p(h,a.b?f(m):m.a),r+=t(h);return r},N:function(a,c,b){for(;0<=b;b--)p(c[b].a,a)},T:function(a){for(var c=a.length-1,b;0<=c;c--)0===a[c].children.length?0<c?(b=a[c-1].children,b.splice(b.indexOf(a[c]),1)):this.clear():e(a[c],this.d)},
W:function(a){var b=["return a"," - b",";"];this.n=new Function("a","b",b.join(a[0]));this.o=new Function("a","b",b.join(a[1]));this.d=new Function("a","return [a"+a.join(", a")+"];")}};"undefined"!==typeof q?q.exports=k:"undefined"!==typeof self?self.M=k:window.M=k})()},{}],3:[function(n,q){var k=n("./marker"),e=k.extend({options:{radiusRatio:1.2},onAdd:function(e){this.on("mouseover",this.F,this).on("mouseout",this.D,this);k.prototype.onAdd.call(this,e)},onRemove:function(e){this.off("mouseover",
this.F,this).off("mouseout",this.D,this);k.prototype.onRemove.call(this,e)},F:function(){this.setRadius(this.options.radius*this.options.radiusRatio)},D:function(){this.setRadius(this.options.radius/this.options.radiusRatio)}});q.exports=e},{"./marker":5}],4:[function(n,q){function k(e,g){var k=e[0]-g[0],h=e[1]-g[1];return k*k+h*h}q.exports={ca:function(e,g,p){var h=p[0]-g[0],n=p[1]-g[1],q=h*h+n*n,q=q&&((e[0]-g[0])*h+(e[1]-g[1])*(p[1]-g[1]))/q;return k(e,0>=q?g:1<=q?p:[g[0]+q*h,g[1]+q*n])},closestPointOnSegment:function(e,
g,k){var h=k[0]-g[0],n=k[1]-g[1];e=((e[0]-g[0])*h+(e[1]-g[1])*n)/(h*h+n*n);return[g[0]+e*(k[0]-g[0]),g[1]+e*(k[1]-g[1])]},ba:function(e,g,k,h){k/=h;h=e[0];e=e[1];return[h+k*(g[0]-h),e+k*(g[1]-e)]},distance:function(e,g){return Math.sqrt(k(e,g))}}},{}],5:[function(n,q){(function(k){k=(k.L||n("leaflet")).CircleMarker.extend({show:function(){this._container.style.visibility="";return this},hide:function(){this._container.style.visibility="hidden";return this}});q.exports=k}).call(this,"undefined"!==
typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}],6:[function(n,q){(function(k){var e=k.L||n("leaflet"),g=n("./geometry"),p=n("./marker"),h=n("./endpoint"),A=n("./selection"),u=k.M||n("rbush"),t=e.Control.extend({includes:e.Mixin.Events,statics:{Selection:A,Endpoint:h,ControlMarker:p},options:{startMarkerClass:"select-marker select-start-marker",endMarkerClass:"select-marker select-end-marker",movingMarkerClass:"select-marker select-moving-marker",
name:"leaflet-linestring-select",lineWeight:4,lineTolerance:e.Browser.touch?10:5,movingMarkerStyle:{fillColor:"#fff",fillOpacity:1,weight:2,opacity:.5,color:"#000"},endpointStyle:{radius:5,color:"#111",fillColor:"#fff",fillOpacity:1},selectionStyle:{color:"#0ff",opacity:1},useTouch:e.Browser.touch,position:"topright"},initialize:function(a){a=a||{};this.m=this.e=this.f=this._feature=this._movingMarker=this._endMarker=this._startMarker=null;e.Util.setOptions(this,a);e.Control.prototype.initialize.call(this,
this.options)},onAdd:function(){var a=this._container=e.DomUtil.create("div",this.options.fa);e.DomEvent.disableClickPropagation(a).disableScrollPropagation(a);return a},onRemove:function(){this.disable()},enable:function(a){this.f=a.layer;this._feature=a.feature||a.layer.toGeoJSON();this.U();this.O();this.f.on("click",this.A,this);this._map.on("moveend zoomend resize",this.j,this).on("mousemove touchmove",this.G,this).on("mousedown touchstart",this.C,this).on("click contextmenu",this.B,this);this.j();
return this},disable:function(){this.reset();this._map.removeLayer(this._movingMarker);this._movingMarker=null;this.f.off("click",this.A,this);this._map.off("moveend zoomend resize",this.j,this).off("mousemove touchmove",this.G,this).off("mousedown touchstart",this.C,this).off("click contextmenu",this.B,this);this.f=this._feature=null;return this},reset:function(){this._startMarker&&(this._map.removeLayer(this._startMarker),this._startMarker=null);this._endMarker&&(this._map.removeLayer(this._endMarker),
this._endMarker=null);this.e&&(this._map.removeLayer(this.e),this.e=null);this._movingMarker.setLatLng(this.f.getLatLngs()[0]);this.options.useTouch||this._movingMarker.show();this.fire("reset");return this},getSelection:function(){return this.e?this.e.getLatLngs():null},toGeoJSON:function(){return this.e?this.e.toGeoJSON():null},selectMeters:function(a,b){this.reset();if(0>a||0>b)throw Error("Can't use negative meter values for distance selection");var f=this.H(a),e=this.H(b),f=this.g(f),e=this.g(e);
this.h(f,f.start,f.end);this.h(e,e.start,e.end);return this},movingMarkerFactory:function(a,b){return new p(a,b)},endpointFactory:function(a,b){return new h(a,b)},selectionFactory:function(a,b,f){return new A(a,b,f)},s:function(a,b){return this.options.distance?this.options.distance(a,b):(new e.LatLng(a[1],a[0])).distanceTo(new e.LatLng(b[1],b[0]))},u:function(a){if(this.options.getProjectedPoint)return this.options.getProjectedPoint.call(this,a);a=this._map.options.crs.latLngToPoint(new e.LatLng(a[1],
a[0]),this._map.getMaxZoom());return[a.x,a.y]},Z:function(a,b,f){var h=this.s(a,b);a=this.u(a);b=this.u(b);a=g.ba(a,b,f,h);return e.point(a)},H:function(a){for(var b=this._feature.geometry.coordinates,f=0,g=1,h=b.length;g<h;g++){var d=this.s(b[g-1],b[g]);if(f+d<=a)f+=d;else break}if(f===a||g===b.length)return a=b[g-1],new e.LatLng(a[1],a[0]);a=this.Z(b[g-1],b[g],a-f);return this._map.options.crs.pointToLatLng(a,this._map.getMaxZoom())},j:function(){var a=this._map.getCenter(),b=.5*this.options.lineWeight+
this.options.lineTolerance,b=this._map.layerPointToLatLng(this._map.latLngToLayerPoint(a).add(new e.Point(b,b)));this.m=new e.LatLng(Math.abs(a.lat-b.lat),Math.abs(a.lng-b.lng))},U:function(){var a=e.latLng(this.f._latlngs[0]),b=this.options.movingMarkerStyle;b.radius=this.options.lineTolerance;b.className=this.options.movingMarkerClass;this._movingMarker=this.movingMarkerFactory(a,b).addTo(this._map);this._movingMarker.on("click",this.Y,this);this.options.useTouch&&this._movingMarker.hide()},Y:function(){this.h(this._movingMarker.getLatLng(),
this._movingMarker.start,this._movingMarker.end)},A:function(a){var b=this.g(a.latlng);b?this.h(e.latLng(b),b.start,b.end):this.h(a.latlng)},B:function(a){if(!this._endMarker){var b=this._map.latLngToLayerPoint(a.latlng),f=this._movingMarker.getLatLng();this.options.useTouch&&(a=this.g(a.latlng))&&(f=e.latLng(a),this._movingMarker.setLatLng(f));a=this._map.latLngToLayerPoint(f);g.distance([b.x,b.y],[a.x,a.y])<=2*this.options.lineTolerance&&(f=this.g(f),this.h(f,f.start,f.end))}},h:function(a,b,f){var e=
this.options.endpointStyle;this._startMarker?this._endMarker||(e.className=this.options.endMarkerClass,this._endMarker=this.endpointFactory(a,e,!0).addTo(this._map),this._endMarker.start=b,this._endMarker.end=f,this._movingMarker.hide(),this.fire("select:end",{latlng:a}),this.l()):(e.className=this.options.startMarkerClass,this._startMarker=this.endpointFactory(a,e,!1).addTo(this._map),this._startMarker.start=b,this._startMarker.end=f,this.fire("select:start",{latlng:a}))},V:function(a){var b=this.m.lng,
f=this.m.lat;return[[a.lat-f,a.lng-b],[a.lat+f,a.lng+b]]},C:function(a){var b=a.originalEvent.target||a.originalEvent.srcElement;if(this.options.useTouch){var f;this._startMarker&&(f=this._map.latLngToContainerPoint(this._startMarker.getLatLng()),g.distance([a.containerPoint.x,a.containerPoint.y],[f.x,f.y])<=2*this.options.lineTolerance&&(b=this._startMarker._path));this._endMarker&&(f=this._map.latLngToContainerPoint(this._endMarker.getLatLng()),g.distance([a.containerPoint.x,a.containerPoint.y],
[f.x,f.y])<=2*this.options.lineTolerance&&(b=this._endMarker._path))}this._startMarker&&this._startMarker._path===b?this.c=this._startMarker:this._endMarker&&this._endMarker._path===b&&(this.c=this._endMarker);this.c&&(e.DomEvent.stop(a),this.c.c=!0,this._map.dragging.disable(),this._map.once("mouseup",this.J,this))},J:function(a){this.c&&(k.clearTimeout(this.t),this._map.dragging.enable(),this.c=this.c.c=null,this.X(this.c,a.latlng))},X:function(){this.l()},P:function(){if(this._startMarker.start>
this._endMarker.start){var a=this._startMarker;this._startMarker=this._endMarker;this._endMarker=a}},l:function(){this.P();var a=this.f._latlngs.slice(this._startMarker.end,this._endMarker.start+1);a.unshift(this._startMarker.getLatLng());a.push(this._endMarker.getLatLng());this.e?(this.e._latlngs=a,this.e.da(this._startMarker.end,this._endMarker.start)):(this.e=this.selectionFactory(a,this.options.selectionStyle,this.f).addTo(this._map),this._startMarker.bringToFront(),this._endMarker.bringToFront());
this.fire("selection")},G:function(a){var b=this.g(a.latlng);this.c?(b&&(this.c.start=b.start,this.c.end=b.end,this.c.setLatLng(b)),this._startMarker&&this._endMarker&&this.l(),k.clearTimeout(this.t),this.t=k.setTimeout(this.J.bind(this,a),750)):b&&(this._movingMarker.setLatLng(b),this._movingMarker.start=b.start,this._movingMarker.end=b.end)},g:function(a,b){var f=this.V(a,b),f=this.i.search(this.K(f[0].reverse(),f[1].reverse()));if(0!==f.length){var e=this._feature.geometry.coordinates,h=Number.MAX_VALUE,
d=[a.lng,a.lat],c=f[0].start,k=f[0].end,n=e[c],p=e[k];if(1<f.length)for(var l=0,q=f.length;l<q;l++){var t=e[f[l].start],m=e[f[l].end],u=g.ca(d,t,m);u<h&&(h=u,n=t,p=m,c=f[l].start,k=f[l].end)}d=g.closestPointOnSegment(d,n,p);d=[d[1],d[0]];d.start=c;d.end=k;return d}return null},O:function(){var a=this._feature.geometry.coordinates,b=[];this.i?this.i.clear():this.i=u();for(var f=1,e=a.length;f<e;f++){var g=this.K(a[f-1],a[f]);g.start=f-1;g.end=f;b.push(g)}this.i.load(b)},K:function(a,b){var f=a[0],
e=b[0],g=a[1],d=b[1];f>e&&(e=a[0],f=b[0]);g>d&&(d=a[1],g=b[1]);return[f,g,e,d]}});q.exports=t}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./endpoint":3,"./geometry":4,"./marker":5,"./selection":7,leaflet:void 0,rbush:2}],7:[function(n,q){(function(k){var e=k.L||n("leaflet");k=e.Polyline.extend({initialize:function(g,k,h){this._source=h;e.Polyline.prototype.initialize.call(this,g,k)},da:function(e,k){this._originalPoints=this._source._originalPoints.slice(e,
k+1);this._originalPoints.unshift(this._map.latLngToLayerPoint(this._latlngs[0]));this._originalPoints.push(this._map.latLngToLayerPoint(this._latlngs[this._latlngs.length-1]));this._updatePath()}});q.exports=k}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}]},{},[1])(1)}
if("object"==typeof exports&&"undefined"!=typeof module)module.exports=w();else if("function"==typeof define&&define.ea)define([],w);else{var y;"undefined"!=typeof window?y=window:"undefined"!=typeof global?y=global:"undefined"!=typeof self&&(y=self);var z=y,z=z.L||(z.L={}),z=z.Control||(z.Control={});z.LineStringSelect=w()}!0;
