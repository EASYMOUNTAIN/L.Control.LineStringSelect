/*
 MIT
 @author Alexander Milevski <info@w8r.name>
 @preserve
*/
(function(w){if("object"===typeof exports&&"undefined"!==typeof module)module.exports=w();else if("function"===typeof define&&define.pa)define([],w);else{var d;d="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this;d=d.L||(d.L={});d=d.Control||(d.Control={});d.LineStringSelect=w()}})(function(){return function d(q,g,b){function e(h,l){if(!g[h]){if(!q[h]){var p="function"==typeof require&&require;if(!l&&p)return p(h,!0);if(f)return f(h,!0);p=Error("Cannot find module '"+
h+"'");throw p.code="MODULE_NOT_FOUND",p;}p=g[h]={exports:{}};q[h][0].call(p.exports,function(a){var c=q[h][1][a];return e(c?c:a)},p,p.exports,d,q,g,b)}return g[h].exports}for(var f="function"==typeof require&&require,h=0;h<b.length;h++)e(b[h]);return e}({1:[function(d,q){(("undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{}).L||d("leaflet")).Control.LineStringSelect=q.exports=d("./src/select")},{"./src/select":7,leaflet:void 0}],2:[function(d,q){function g(f,
h,d,l,p){d=d||0;l=l||f.length-1;for(p=p||e;l>d;){if(600<l-d){var a=l-d+1,c=h-d+1,m=Math.log(a),n=.5*Math.exp(2*m/3),m=.5*Math.sqrt(m*n*(a-n)/a)*(0>c-a/2?-1:1);g(f,h,Math.max(d,Math.floor(h-c*n/a+m)),Math.min(l,Math.floor(h+(a-c)*n/a+m)),p)}a=f[h];c=d;n=l;b(f,d,h);for(0<p(f[l],a)&&b(f,d,l);c<n;){b(f,c,n);c++;for(n--;0>p(f[c],a);)c++;for(;0<p(f[n],a);)n--}0===p(f[d],a)?b(f,d,n):(n++,b(f,n,l));n<=h&&(d=n+1);h<=n&&(l=n-1)}}function b(b,h,e){var d=b[h];b[h]=b[e];b[e]=d}function e(b,e){return b<e?-1:b>
e?1:0}q.exports=g},{}],3:[function(d,q){function g(k,a){if(!(this instanceof g))return new g(k,a);this.v=Math.max(4,k||9);this.M=Math.max(2,Math.ceil(.4*this.v));a&&this.ga(a);this.clear()}function b(k,a){e(k,0,k.children.length,a,k)}function e(k,a,c,b,r){r||(r=m(null));r.a=Infinity;r.b=Infinity;r.f=-Infinity;r.g=-Infinity;for(var e;a<c;a++)e=k.children[a],f(r,k.c?b(e):e);return r}function f(k,a){k.a=Math.min(k.a,a.a);k.b=Math.min(k.b,a.b);k.f=Math.max(k.f,a.f);k.g=Math.max(k.g,a.g)}function h(k,
a){return k.a-a.a}function t(k,a){return k.b-a.b}function l(k){return(k.f-k.a)*(k.g-k.b)}function p(k){return k.f-k.a+(k.g-k.b)}function a(k,a){return k.a<=a.a&&k.b<=a.b&&a.f<=k.f&&a.g<=k.g}function c(k,a){return a.a<=k.f&&a.b<=k.g&&a.f>=k.a&&a.g>=k.b}function m(a){return{children:a,height:1,c:!0,a:Infinity,b:Infinity,f:-Infinity,g:-Infinity}}function n(a,c,b,m,r){for(var e=[c,b],n;e.length;)b=e.pop(),c=e.pop(),b-c<=m||(n=c+Math.ceil((b-c)/m/2)*m,z(a,n,c,b,r),e.push(c,n,n,b))}q.exports=g;var z=d("quickselect");
g.prototype={all:function(){return this.D(this.data,[])},search:function(k){var b=this.data,m=[],e=this.i;if(!c(k,b))return m;for(var r=[],n,h,d,f;b;){n=0;for(h=b.children.length;n<h;n++)d=b.children[n],f=b.c?e(d):d,c(k,f)&&(b.c?m.push(d):a(k,f)?this.D(d,m):r.push(d));b=r.pop()}return m},load:function(a){if(!a||!a.length)return this;if(a.length<this.M){for(var c=0,b=a.length;c<b;c++)this.la(a[c]);return this}a=this.G(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?
this.V(this.data,a):(this.data.height<a.height&&(c=this.data,this.data=a,a=c),this.K(a,this.data.height-a.height-1,!0)):this.data=a;return this},la:function(a){a&&this.K(a,this.data.height-1);return this},clear:function(){this.data=m([]);return this},remove:function(k,c){if(!k)return this;for(var b=this.data,m=this.i(k),e=[],n=[],d,h,f,g;b||e.length;){b||(b=e.pop(),h=e[e.length-1],d=n.pop(),g=!0);if(b.c){a:{f=k;var l=b.children,p=c;if(p){for(var q=0;q<l.length;q++)if(p(f,l[q])){f=q;break a}f=-1}else f=
l.indexOf(f)}if(-1!==f){b.children.splice(f,1);e.push(b);this.da(e);break}}g||b.c||!a(b,m)?h?(d++,b=h.children[d],g=!1):b=null:(e.push(b),n.push(d),d=0,h=b,b=b.children[0])}return this},i:function(a){return a},B:h,C:t,toJSON:function(){return this.data},D:function(a,b){for(var c=[];a;)a.c?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},G:function(a,c,e,d){var f=e-c+1,h=this.v,g;if(f<=h)return g=m(a.slice(c,e+1)),b(g,this.i),g;d||(d=Math.ceil(Math.log(f)/Math.log(h)),h=Math.ceil(f/
Math.pow(h,d-1)));g=m([]);g.c=!1;g.height=d;var f=Math.ceil(f/h),h=f*Math.ceil(Math.sqrt(h)),l,u,p;for(n(a,c,e,h,this.B);c<=e;c+=h)for(u=Math.min(c+h-1,e),n(a,c,u,f,this.C),l=c;l<=u;l+=f)p=Math.min(l+f-1,u),g.children.push(this.G(a,l,p,d-1));b(g,this.i);return g},ca:function(a,c,b,m){for(var e,h,f,n,d,g,p,q;;){m.push(c);if(c.c||m.length-1===b)break;p=q=Infinity;e=0;for(h=c.children.length;e<h;e++)f=c.children[e],d=l(f),g=(Math.max(f.f,a.f)-Math.min(f.a,a.a))*(Math.max(f.g,a.g)-Math.min(f.b,a.b))-
d,g<q?(q=g,p=d<p?d:p,n=f):g===q&&d<p&&(p=d,n=f);c=n||c.children[0]}return c},K:function(a,c,b){var e=this.i;b=b?a:e(a);var e=[],m=this.ca(b,this.data,c,e);m.children.push(a);for(f(m,b);0<=c;)if(e[c].children.length>this.v)this.ka(e,c),c--;else break;this.Y(b,e,c)},ka:function(a,c){var e=a[c],f=e.children.length,d=this.M;this.aa(e,d,f);f=this.ba(e,d,f);f=m(e.children.splice(f,e.children.length-f));f.height=e.height;f.c=e.c;b(e,this.i);b(f,this.i);c?a[c-1].children.push(f):this.V(e,f)},V:function(a,
c){this.data=m([a,c]);this.data.height=a.height+1;this.data.c=!1;b(this.data,this.i)},ba:function(a,c,b){var m,f,d,h,n,g,p;n=g=Infinity;for(m=c;m<=b-c;m++)f=e(a,0,m,this.i),d=e(a,m,b,this.i),h=Math.max(0,Math.min(f.f,d.f)-Math.max(f.a,d.a))*Math.max(0,Math.min(f.g,d.g)-Math.max(f.b,d.b)),f=l(f)+l(d),h<n?(n=h,p=m,g=f<g?f:g):h===n&&f<g&&(g=f,p=m);return p},aa:function(a,c,b){var e=a.c?this.B:h,f=a.c?this.C:t,m=this.F(a,c,b,e);c=this.F(a,c,b,f);m<c&&a.children.sort(e)},F:function(a,c,b,m){a.children.sort(m);
m=this.i;var d=e(a,0,c,m),h=e(a,b-c,b,m),n=p(d)+p(h),g,l;for(g=c;g<b-c;g++)l=a.children[g],f(d,a.c?m(l):l),n+=p(d);for(g=b-c-1;g>=c;g--)l=a.children[g],f(h,a.c?m(l):l),n+=p(h);return n},Y:function(a,c,b){for(;0<=b;b--)f(c[b],a)},da:function(a){for(var c=a.length-1,e;0<=c;c--)0===a[c].children.length?0<c?(e=a[c-1].children,e.splice(e.indexOf(a[c]),1)):this.clear():b(a[c],this.i)},ga:function(a){var c=["return a"," - b",";"];this.B=new Function("a","b",c.join(a[0]));this.C=new Function("a","b",c.join(a[1]));
this.i=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")}}},{quickselect:2}],4:[function(d,q){var g=d("./marker"),b=g.extend({options:{radiusRatio:1.2},onAdd:function(b){this.on("mouseover",this.S,this).on("mouseout",this.R,this);g.prototype.onAdd.call(this,b)},onRemove:function(b){this.off("mouseover",this.S,this).off("mouseout",this.R,this);g.prototype.onRemove.call(this,b)},S:function(){this.setRadius(this.options.radius*this.options.radiusRatio)},
R:function(){this.setRadius(this.options.radius/this.options.radiusRatio)}});q.exports=b},{"./marker":6}],5:[function(d,q){function g(b,e){var f=b[0]-e[0],d=b[1]-e[1];return f*f+d*d}q.exports={na:function(b,e,f){var d=f[0]-e[0],q=f[1]-e[1],l=d*d+q*q,l=l&&((b[0]-e[0])*d+(b[1]-e[1])*(f[1]-e[1]))/l;return g(b,0>=l?e:1<=l?f:[e[0]+l*d,e[1]+l*q])},closestPointOnSegment:function(b,e,f){var d=f[0]-e[0],g=f[1]-e[1];b=((b[0]-e[0])*d+(b[1]-e[1])*g)/(d*d+g*g);b=0>b?0:1<b?1:b;return[e[0]+b*(f[0]-e[0]),e[1]+b*
(f[1]-e[1])]},ma:function(b,e,f,d){f/=d;d=b[0];b=b[1];return[d+f*(e[0]-d),b+f*(e[1]-b)]},distance:function(b,e){return Math.sqrt(g(b,e))}}},{}],6:[function(d,q){(function(g){g=(g.L||d("leaflet")).CircleMarker.extend({show:function(){this._container.style.visibility="";return this},hide:function(){this._container.style.visibility="hidden";return this}});q.exports=g}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}],
7:[function(d,q){(function(g){var b=g.L||d("leaflet"),e=d("./geometry"),f=d("./marker"),h=d("./endpoint"),t=d("./selection"),l=g.ra||d("rbush"),p=b.Control.extend({includes:b.Mixin.Events,statics:{Selection:t,Endpoint:h,ControlMarker:f},options:{startMarkerClass:"select-marker select-start-marker",endMarkerClass:"select-marker select-end-marker",movingMarkerClass:"select-marker select-moving-marker",name:"leaflet-linestring-select",lineWeight:4,lineTolerance:b.Browser.touch?10:5,movingMarkerStyle:{fillColor:"#fff",
fillOpacity:1,weight:2,opacity:.5,color:"#000"},endpointStyle:{radius:5,color:"#111",fillColor:"#fff",fillOpacity:1},selectionStyle:{color:"#0ff",opacity:1},useTouch:b.Browser.touch,position:"topright"},initialize:function(a){a=a||{};this.A=this.j=this.l=this._feature=this._movingMarker=this._endMarker=this._startMarker=null;b.Util.setOptions(this,a);b.Control.prototype.initialize.call(this,this.options)},onAdd:function(){var a=this._container=b.DomUtil.create("div",this.options.qa);b.DomEvent.disableClickPropagation(a).disableScrollPropagation(a);
return a},onRemove:function(){this.disable()},enable:function(a){this.l=a.layer;this._feature=a.feature||a.layer.toGeoJSON();this.ea();this.Z();this.l.on("click",this.N,this);this._map.on("moveend zoomend resize",this.u,this).on("mousemove touchmove",this.T,this).on(b.Draggable.START.join(" "),this.P,this).on("click contextmenu",this.O,this);this.u();return this},disable:function(){this.reset();this._map.removeLayer(this._movingMarker);this._movingMarker=null;this.l.off("click",this.N,this);this._map.off("moveend zoomend resize",
this.u,this).off("mousemove touchmove",this.T,this).off(b.Draggable.START.join(" "),this.P,this).off("click contextmenu",this.O,this);this.l=this._feature=null;return this},reset:function(){this._startMarker&&(this._map.removeLayer(this._startMarker),this._startMarker=null);this._endMarker&&(this._map.removeLayer(this._endMarker),this._endMarker=null);this.j&&(this._map.removeLayer(this.j),this.j=null);this._movingMarker.setLatLng(this.l.getLatLngs()[0]);this.options.useTouch||this._movingMarker.show();
this.fire("reset");return this},getSelection:function(){return this.j?this.j.getLatLngs():null},toGeoJSON:function(){return this.j?this.j.toGeoJSON():null},selectMeters:function(a,c){this.reset();if(0>a||0>c)throw Error("Can't use negative meter values for distance selection");var b=this.U(a),e=this.U(c),b=this.m(b),e=this.m(e);this.o(b,b.start,b.end);this.o(e,e.start,e.end);return this},movingMarkerFactory:function(a,c){return new f(a,c)},endpointFactory:function(a,c){return new h(a,c)},selectionFactory:function(a,
c,b){return new t(a,c,b)},H:function(a,c){return this.options.distance?this.options.distance(a,c):(new b.LatLng(a[1],a[0])).distanceTo(new b.LatLng(c[1],c[0]))},J:function(a){if(this.options.getProjectedPoint)return this.options.getProjectedPoint.call(this,a);a=this._map.options.crs.latLngToPoint(new b.LatLng(a[1],a[0]),this._map.getMaxZoom());return[a.x,a.y]},ja:function(a,c,d){var f=this.H(a,c);a=this.J(a);c=this.J(c);a=e.ma(a,c,d,f);return b.point(a)},U:function(a){for(var c=this._feature.geometry.coordinates,
e=0,d=1,f=c.length;d<f;d++){var g=this.H(c[d-1],c[d]);if(e+g<=a)e+=g;else break}if(e===a||d===c.length)return a=c[d-1],new b.LatLng(a[1],a[0]);a=this.ja(c[d-1],c[d],a-e);return this._map.options.crs.pointToLatLng(a,this._map.getMaxZoom())},u:function(){var a=this._map.getCenter(),c=.5*this.options.lineWeight+this.options.lineTolerance,c=this._map.layerPointToLatLng(this._map.latLngToLayerPoint(a).add(new b.Point(c,c)));this.A=new b.LatLng(Math.abs(a.lat-c.lat),Math.abs(a.lng-c.lng))},ea:function(){var a=
b.latLng(this.l._latlngs[0]),c=this.options.movingMarkerStyle;c.radius=this.options.lineTolerance;c.className=this.options.movingMarkerClass;this._movingMarker=this.movingMarkerFactory(a,c).addTo(this._map);this._movingMarker.on("click",this.ia,this);this.options.useTouch&&this._movingMarker.hide()},ia:function(){this.o(this._movingMarker.getLatLng(),this._movingMarker.start,this._movingMarker.end)},N:function(a){var c=this.m(a.latlng);c?this.o(b.latLng(c),c.start,c.end):this.o(a.latlng)},O:function(a){if(!this._endMarker){var c=
this._map.latLngToLayerPoint(a.latlng),d=this._movingMarker.getLatLng();this.options.useTouch&&(a=this.m(a.latlng))&&(d=b.latLng(a),this._movingMarker.setLatLng(d));a=this._map.latLngToLayerPoint(d);e.distance([c.x,c.y],[a.x,a.y])<=2*this.options.lineTolerance&&(d=this.m(d),this.o(d,d.start,d.end))}},o:function(a,c,b){var d=this.options.endpointStyle;this._startMarker?this._endMarker||(d.className=this.options.endMarkerClass,this._endMarker=this.endpointFactory(a,d,!0).addTo(this._map),this._endMarker.start=
c,this._endMarker.end=b,this._movingMarker.hide(),this.fire("select:end",{latlng:a}),this._startMarker&&this._endMarker&&this.w()):(d.className=this.options.startMarkerClass,this._startMarker=this.endpointFactory(a,d,!1).addTo(this._map),this._startMarker.start=c,this._startMarker.end=b,this.fire("select:start",{latlng:a}))},fa:function(a){var c=this.A.lng,b=this.A.lat;return[[a.lat-b,a.lng-c],[a.lat+b,a.lng+c]]},P:function(a){var c=a.originalEvent.target||a.originalEvent.srcElement;if(this.options.useTouch){var d;
this._startMarker&&(d=this._map.latLngToContainerPoint(this._startMarker.getLatLng()),e.distance([a.containerPoint.x,a.containerPoint.y],[d.x,d.y])<=2*this.options.lineTolerance&&(c=this._startMarker._path));this._endMarker&&(d=this._map.latLngToContainerPoint(this._endMarker.getLatLng()),e.distance([a.containerPoint.x,a.containerPoint.y],[d.x,d.y])<=2*this.options.lineTolerance&&(c=this._endMarker._path))}this._startMarker&&this._startMarker._path===c?this.h=this._startMarker:this._endMarker&&this._endMarker._path===
c&&(this.h=this._endMarker);this.h&&(b.DomEvent.stop(a),this.h.h=!0,b.Draggable._disabled=!0,this._map.dragging.disable(),this._map.once("mouseup",this.W,this))},W:function(a){this.h&&(g.clearTimeout(this.I),b.Draggable._disabled=!1,this._map.dragging.enable(),this.h=this.h.h=null,this.ha(this.h,a.latlng))},ha:function(){this._startMarker&&this._endMarker&&this.w()},$:function(){if(this._startMarker.start>this._endMarker.start){var a=this._startMarker;this._startMarker=this._endMarker;this._endMarker=
a}},w:function(){this.$();var a=this.l._latlngs.slice(this._startMarker.end,this._endMarker.start+1);a.unshift(this._startMarker.getLatLng());a.push(this._endMarker.getLatLng());this.j?(this.j._latlngs=a,this.j.oa(this._startMarker.end,this._endMarker.start)):(this.j=this.selectionFactory(a,this.options.selectionStyle,this.l).addTo(this._map),this._startMarker.bringToFront(),this._endMarker.bringToFront());this.fire("selection")},T:function(a){var c=this.m(a.latlng);this.h?(c&&(this.h.start=c.start,
this.h.end=c.end,this.h.setLatLng(c)),this._startMarker&&this._endMarker&&this.w(),g.clearTimeout(this.I),this.I=g.setTimeout(this.W.bind(this,a),750)):c&&(this._movingMarker.setLatLng(c),this._movingMarker.start=c.start,this._movingMarker.end=c.end)},m:function(a,c){var b=this.fa(a,c),b=this.s.search(this.X(b[0].reverse(),b[1].reverse()));if(0!==b.length){var d=this._feature.geometry.coordinates,f=Number.MAX_VALUE,g=[a.lng,a.lat],h=b[0].start,l=b[0].end,p=d[h],q=d[l];if(1<b.length)for(var v=0,t=
b.length;v<t;v++){var x=d[b[v].start],u=d[b[v].end],y=e.na(g,x,u);y<f&&(f=y,p=x,q=u,h=b[v].start,l=b[v].end)}g=e.closestPointOnSegment(g,p,q);g=[g[1],g[0]];g.start=h;g.end=l;return g}return null},Z:function(){var a=this._feature.geometry.coordinates,b=[];this.s?this.s.clear():this.s=l();for(var d=1,e=a.length;d<e;d++){var f=this.X(a[d-1],a[d]);f.start=d-1;f.end=d;b.push(f)}this.s.load(b)},X:function(a,b){var d=a[0],e=b[0],f=a[1],g=b[1];d>e&&(e=a[0],d=b[0]);f>g&&(g=a[1],f=b[1]);return[d,f,e,g]}});
q.exports=p}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./endpoint":4,"./geometry":5,"./marker":6,"./selection":8,leaflet:void 0,rbush:3}],8:[function(d,q){(function(g){var b=g.L||d("leaflet");g=b.Polyline.extend({initialize:function(d,f,g){this._source=g;b.Polyline.prototype.initialize.call(this,d,f)},oa:function(b,d){this._originalPoints=this._source._originalPoints.slice(b,d+1);this._originalPoints.unshift(this._map.latLngToLayerPoint(this._latlngs[0]));
this._originalPoints.push(this._map.latLngToLayerPoint(this._latlngs[this._latlngs.length-1]));this._updatePath()}});q.exports=g}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}]},{},[1])(1)});
