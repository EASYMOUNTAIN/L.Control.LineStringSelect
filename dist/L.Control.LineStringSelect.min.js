!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self);var i=e;i=i.L||(i.L={}),i=i.Control||(i.Control={}),i.LineStringSelect=t()}}(function(){var t;return function e(t,i,n){function r(o,a){if(!i[o]){if(!t[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[o]={exports:{}};t[o][0].call(c.exports,function(e){var i=t[o][1][e];return r(i?i:e)},c,c.exports,e,t,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e){(function(i){/**
 * Leaflet LineString selection control
 * @license MIT
 * @author Alexander Milevski <info@w8r.name>
 * @preserve
 */
var n=i.L||t("leaflet");n.Control.LineStringSelect=e.exports=t("./src/select")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/select":6,leaflet:void 0}],2:[function(e,i){!function(){"use strict";function e(t,i){return this instanceof e?(this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&this._initFormat(i),void this.clear()):new e(t,i)}function n(t,e){t.bbox=r(t,0,t.children.length,e)}function r(t,e,i,n){for(var r,a=s(),h=e;i>h;h++)r=t.children[h],o(a,t.leaf?n(r):r.bbox);return a}function s(){return[1/0,1/0,-1/0,-1/0]}function o(t,e){return t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t}function a(t,e){return t.bbox[0]-e.bbox[0]}function h(t,e){return t.bbox[1]-e.bbox[1]}function l(t){return(t[2]-t[0])*(t[3]-t[1])}function c(t){return t[2]-t[0]+(t[3]-t[1])}function u(t,e){return(Math.max(e[2],t[2])-Math.min(e[0],t[0]))*(Math.max(e[3],t[3])-Math.min(e[1],t[1]))}function _(t,e){var i=Math.max(t[0],e[0]),n=Math.max(t[1],e[1]),r=Math.min(t[2],e[2]),s=Math.min(t[3],e[3]);return Math.max(0,r-i)*Math.max(0,s-n)}function f(t,e){return t[0]<=e[0]&&t[1]<=e[1]&&e[2]<=t[2]&&e[3]<=t[3]}function d(t,e){return e[0]<=t[2]&&e[1]<=t[3]&&e[2]>=t[0]&&e[3]>=t[1]}function g(t,e,i,n,r){for(var s,o=[e,i];o.length;)i=o.pop(),e=o.pop(),n>=i-e||(s=e+Math.ceil((i-e)/n/2)*n,p(t,e,i,s,r),o.push(e,s,s,i))}function p(t,e,i,n,r){for(var s,o,a,h,l,c,u,_,f;i>e;){for(i-e>600&&(s=i-e+1,o=n-e+1,a=Math.log(s),h=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*h*(s-h)/s)*(0>o-s/2?-1:1),c=Math.max(e,Math.floor(n-o*h/s+l)),u=Math.min(i,Math.floor(n+(s-o)*h/s+l)),p(t,c,u,n,r)),_=t[n],o=e,f=i,m(t,e,n),r(t[i],_)>0&&m(t,e,i);f>o;){for(m(t,o,f),o++,f--;r(t[o],_)<0;)o++;for(;r(t[f],_)>0;)f--}0===r(t[e],_)?m(t,e,f):(f++,m(t,f,i)),n>=f&&(e=f+1),f>=n&&(i=f-1)}}function m(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}e.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],n=this.toBBox;if(!d(t,e.bbox))return i;for(var r,s,o,a,h=[];e;){for(r=0,s=e.children.length;s>r;r++)o=e.children[r],a=e.leaf?n(o):o.bbox,d(t,a)&&(e.leaf?i.push(o):f(t,a)?this._all(o,i):h.push(o));e=h.pop()}return i},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;i>e;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:s(),leaf:!0},this},remove:function(t){if(!t)return this;for(var e,i,n,r,s=this.data,o=this.toBBox(t),a=[],h=[];s||a.length;){if(s||(s=a.pop(),i=a[a.length-1],e=h.pop(),r=!0),s.leaf&&(n=s.children.indexOf(t),-1!==n))return s.children.splice(n,1),a.push(s),this._condense(a),this;r||s.leaf||!f(s.bbox,o)?i?(e++,s=i.children[e],r=!1):s=null:(a.push(s),h.push(e),e=0,i=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:function(t,e){return t[0]-e[0]},compareMinY:function(t,e){return t[1]-e[1]},toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,r){var s,o=i-e+1,a=this._maxEntries;if(a>=o)return s={children:t.slice(e,i+1),height:1,bbox:null,leaf:!0},n(s,this.toBBox),s;r||(r=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,r-1))),s={children:[],height:r,bbox:null};var h,l,c,u,_=Math.ceil(o/a),f=_*Math.ceil(Math.sqrt(a));for(g(t,e,i,f,this.compareMinX),h=e;i>=h;h+=f)for(c=Math.min(h+f-1,i),g(t,h,c,_,this.compareMinY),l=h;c>=l;l+=_)u=Math.min(l+_-1,c),s.children.push(this._build(t,l,u,r-1));return n(s,this.toBBox),s},_chooseSubtree:function(t,e,i,n){for(var r,s,o,a,h,c,_,f;;){if(n.push(e),e.leaf||n.length-1===i)break;for(_=f=1/0,r=0,s=e.children.length;s>r;r++)o=e.children[r],h=l(o.bbox),c=u(t,o.bbox)-h,f>c?(f=c,_=_>h?h:_,a=o):c===f&&_>h&&(_=h,a=o);e=a}return e},_insert:function(t,e,i){var n=this.toBBox,r=i?t.bbox:n(t),s=[],a=this._chooseSubtree(r,this.data,e,s);for(a.children.push(t),o(a.bbox,r);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(r,s,e)},_split:function(t,e){var i=t[e],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);var o={children:i.children.splice(this._chooseSplitIndex(i,s,r)),height:i.height};i.leaf&&(o.leaf=!0),n(i,this.toBBox),n(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(t,e){this.data={children:[t,e],height:t.height+1},n(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var n,s,o,a,h,c,u,f;for(c=u=1/0,n=e;i-e>=n;n++)s=r(t,0,n,this.toBBox),o=r(t,n,i,this.toBBox),a=_(s,o),h=l(s)+l(o),c>a?(c=a,f=n,u=u>h?h:u):a===c&&u>h&&(u=h,f=n);return f},_chooseSplitAxis:function(t,e,i){var n=t.leaf?this.compareMinX:a,r=t.leaf?this.compareMinY:h,s=this._allDistMargin(t,e,i,n),o=this._allDistMargin(t,e,i,r);o>s&&t.children.sort(n)},_allDistMargin:function(t,e,i,n){t.children.sort(n);var s,a,h=this.toBBox,l=r(t,0,e,h),u=r(t,i-e,i,h),_=c(l)+c(u);for(s=e;i-e>s;s++)a=t.children[s],o(l,t.leaf?h(a):a.bbox),_+=c(l);for(s=i-e-1;s>=e;s--)a=t.children[s],o(u,t.leaf?h(a):a.bbox),_+=c(u);return _},_adjustParentBBoxes:function(t,e,i){for(var n=i;n>=0;n--)o(e[n].bbox,t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children,e.splice(e.indexOf(t[i]),1)):this.clear():n(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return [a"+t.join(", a")+"];")}},"function"==typeof t&&t.amd?t(function(){return e}):"undefined"!=typeof i?i.exports=e:"undefined"!=typeof self?self.rbush=e:window.rbush=e}()},{}],3:[function(t,e){"use strict";var i=t("./marker"),n=i.extend({options:{radiusRatio:1.2},onAdd:function(t){this.on("mouseover",this._onMouseOver,this).on("mouseout",this._onMouseOut,this),i.prototype.onAdd.call(this,t)},onRemove:function(t){this.off("mouseover",this._onMouseOver,this).off("mouseout",this._onMouseOut,this),i.prototype.onRemove.call(this,t)},_onMouseOver:function(){this.setRadius(this.options.radius*this.options.radiusRatio)},_onMouseOut:function(){this.setRadius(this.options.radius/this.options.radiusRatio)}});e.exports=n},{"./marker":5}],4:[function(t,e){"use strict";function i(t,e){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function n(t,e,n){var r=n[0]-e[0],s=n[1]-e[1],o=r*r+s*s,a=o&&((t[0]-e[0])*r+(t[1]-e[1])*(n[1]-e[1]))/o;return i(t,0>=a?e:a>=1?n:[e[0]+a*r,e[1]+a*s])}function r(t,e,i){var n=i[0]-e[0],r=i[1]-e[1],s=t[0]-e[0],o=t[1]-e[1];return(s*n+o*r)/(n*n+r*r)}function s(t,e,i){var n=r(t,e,i),s=i[0]-e[0],o=i[1]-e[1],a=[e[0]+n*s,e[1]+n*o];return a}function o(t,e,i){return t+i*(e-t)}function a(t,e,i,n){var r=i/n;return[o(t[0],e[0],r),o(t[1],e[1],r)]}e.exports={pointSegmentDistance:n,closestPointOnSegment:s,pointOnSegment:a}},{}],5:[function(t,e){"use strict";var i=t("leaflet"),n=i.CircleMarker.extend({show:function(){return this._container.style.visibility="",this},hide:function(){return this._container.style.visibility="hidden",this}});e.exports=n},{leaflet:void 0}],6:[function(t,e){(function(i){"use strict";var n=i.L||t("leaflet"),r=t("./geometry"),s=t("./marker"),o=t("./endpoint"),a=t("./selection"),h=i.rbush||t("rbush"),l=n.Control.extend({includes:n.Mixin.Events,options:{startMarkerClass:"select-marker select-start-marker",endMarkerClass:"select-marker select-end-marker",movingMarkerClass:"select-marker select-moving-marker",name:"leaflet-linestring-select",lineWeight:4,lineTolerance:5,movingMarkerStyle:{fillColor:"#fff",fillOpacity:1,weight:2,opacity:.5,color:"#000"},endpointStyle:{radius:5,color:"#111",fillColor:"#fff",fillOpacity:1},selectionStyle:{color:"#0ff",opacity:1},position:"topright"},initialize:function(t){t=t||{},this._startMarker=null,this._endMarker=null,this._movingMarker=null,this._feature=null,this._layer=null,this._selection=null,this._tolerance=null,n.Util.setOptions(this,t),n.Control.prototype.initialize.call(this,this.options)},onAdd:function(){var t=this._container=n.DomUtil.create("div",this.options.containerClass);return n.DomEvent.disableClickPropagation(t).disableScrollPropagation(t),t},onRemove:function(){},enable:function(t){return this._layer=t.layer,this._feature=t.feature||t.layer.toGeoJSON(),this._createHandles(),this._buildTree(),this._layer.on("click",this._onLayerClick,this),this._map.on("moveend zoomend resize",this._calculatePointerTolerance,this),this._map.on("mousemove",this._onMousemove,this).on("mousedown",this._onMouseDown,this).on("click",this._onMapClick,this),this._calculatePointerTolerance(),this},disable:function(){return this.reset(),this._map.removeLayer(this._movingMarker),this._movingMarker=null,this._layer.off("click",this._onLayerClick,this),this._map.off("moveend zoomend resize",this._calculatePointerTolerance,this),this._map.off("mousemove",this._onMousemove,this).off("mousedown",this._onMouseDown,this).off("click",this._onMapClick,this),this._feature=null,this._layer=null,this},reset:function(){return this._startMarker&&(this._map.removeLayer(this._startMarker),this._startMarker=null),this._endMarker&&(this._map.removeLayer(this._endMarker),this._endMarker=null),this._selection&&(this._map.removeLayer(this._selection),this._selection=null),this._movingMarker.setLatLng(this._layer.getLatLngs()[0]).show(),this},getSelection:function(){return this._selection?this._selection.getLatLngs():null},toGeoJSON:function(){return this._selection?this._selection.toGeoJSON():null},selectMeters:function(t,e){if(this.reset(),0>t||0>e)throw new Error("Can't use negative meter values for distance selection");var i=this._pointAtM(t),n=this._pointAtM(e);return i=this._getNearestPoint(i),n=this._getNearestPoint(n),this._setPoint(i,i.start,i.end),this._setPoint(n,n.start,n.end),this},_distance:function(t,e){return this.options.distance?this.options.distance(t,e):new n.LatLng(t[1],t[0]).distanceTo(new n.LatLng(e[1],e[0]))},_getProjectedPoint:function(t){return this.options.getProjectedPoint?this.options.getProjectedPoint.call(this,t):(t=this._map.options.crs.latLngToPoint(new n.LatLng(t[1],t[0]),this._map.getMaxZoom()),[t.x,t.y])},_pointAtSegmentM:function(t,e,i){var s=this._distance(t,e);t=this._getProjectedPoint(t),e=this._getProjectedPoint(e);var o=r.pointOnSegment(t,e,i,s);return n.point(o)},_pointAtM:function(t){for(var e,i=this._feature.geometry.coordinates,r=0,s=1,o=i.length;o>s;s++){var a=this._distance(i[s-1],i[s]);if(!(t>=r+a))break;r+=a}return r===t||s===i.length?(e=i[s-1],new n.LatLng(e[1],e[0])):(e=this._pointAtSegmentM(i[s-1],i[s],t-r),this._map.options.crs.pointToLatLng(e,this._map.getMaxZoom()))},_calculatePointerTolerance:function(){var t=this._map.getCenter(),e=.5*this.options.lineWeight+this.options.lineTolerance,i=this._map.layerPointToLatLng(this._map.latLngToLayerPoint(t).add(new n.Point(e,e)));this._tolerance=new n.LatLng(Math.abs(t.lat-i.lat),Math.abs(t.lng-i.lng))},_createHandles:function(){var t=n.latLng(this._layer._latlngs[0]),e=this.options.movingMarkerStyle;e.radius=this.options.lineTolerance,e.className=this.options.movingMarkerClass,this._movingMarker=new s(t,e).addTo(this._map),this._movingMarker.on("click",this._onMovingMarkerClick,this)},_onMovingMarkerClick:function(){this._setPoint(this._movingMarker.getLatLng(),this._movingMarker.start,this._movingMarker.end)},_onLayerClick:function(t){var e=this._getNearestPoint(t.latlng);e?this._setPoint(n.latLng(e),e.start,e.end):this._setPoint(t.latlng)},_onMapClick:function(t){if(!this._endMarker){var e=this._map.latLngToLayerPoint(t.latlng),i=this._movingMarker.getLatLng(),n=this._map.latLngToLayerPoint(i),r=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2));r<=2*this.options.lineTolerance&&(i=this._getNearestPoint(i),this._setPoint(i,i.start,i.end))}},_setPoint:function(t,e,i){var n=this.options.endpointStyle;this._startMarker?this._endMarker||(n.className=this.options.endMarkerClass,this._endMarker=new o(t,n).addTo(this._map),this._endMarker.start=e,this._endMarker.end=i,this._movingMarker.hide(),this.fire("select:end",{latlng:t}),this._onSelect()):(n.className=this.options.startMarkerClass,this._startMarker=new o(t,n).addTo(this._map),this._startMarker.start=e,this._startMarker.end=i,this.fire("select:start",{latlng:t}))},_getPointerBounds:function(t){var e=this._tolerance.lng,i=this._tolerance.lat;return[[t.lat-i,t.lng-e],[t.lat+i,t.lng+e]]},_onMouseDown:function(t){var e=t.originalEvent.target||t.originalEvent.srcElement;this._startMarker&&this._startMarker._path===e?(this._dragging=this._startMarker,this._static=this._endMarker):this._endMarker&&this._endMarker._path===e&&(this._dragging=this._endMarker,this._static=this._startMarker),this._dragging&&(n.DomEvent.stop(t),this._dragging._dragging=!0,this._map.dragging.disable(),this._map.once("mouseup",this._stopHandlerDrag,this))},_stopHandlerDrag:function(t){this._dragging&&(i.clearTimeout(this._dragTimer),this._map.dragging.enable(),this._dragging._dragging=null,this._dragging=null,this._onDragStopped(this._dragging,t.latlng))},_onDragStopped:function(){this._onSelect()},_checkEndPoints:function(){if(this._startMarker.start>this._endMarker.start){var t=this._startMarker;this._startMarker=this._endMarker,this._endMarker=t}},_onSelect:function(){this._checkEndPoints();var t=this._startMarker.end,e=this._endMarker.start,i=this._layer._latlngs.slice(t,e+1);i.unshift(this._startMarker.getLatLng()),i.push(this._endMarker.getLatLng()),this._selection?(this._selection._latlngs=i,this._selection.updatePathFromSource(this._startMarker.end,this._endMarker.start)):(this._selection=new a(i,this.options.selectionStyle,this._layer).addTo(map),this._startMarker.bringToFront(),this._endMarker.bringToFront()),this.fire("selection")},_onMousemove:function(t){var e=this._getNearestPoint(t.latlng);this._dragging?(e&&(this._dragging.start=e.start,this._dragging.end=e.end,this._dragging.setLatLng(e)),this._startMarker&&this._endMarker&&this._onSelect(),i.clearTimeout(this._dragTimer),this._dragTimer=i.setTimeout(this._stopHandlerDrag.bind(this,t),750)):e&&(this._movingMarker.setLatLng(e),this._movingMarker.start=e.start,this._movingMarker.end=e.end)},_getNearestPoint:function(t,e){var i=this._getPointerBounds(t,e),n=(this._map,this._tree.search(this._toTreeNode(i[0].reverse(),i[1].reverse())));if(0!==n.length){var s=this._feature.geometry.coordinates,o=Number.MAX_VALUE,a=[t.lng,t.lat],h=n[0].start,l=n[0].end,c=s[h],u=s[l];if(n.length>1)for(var _=0,f=n.length;f>_;_++){var d=(n[_],s[n[_].start]),g=s[n[_].end],p=r.pointSegmentDistance(a,d,g);o>p&&(o=p,c=d,u=g,h=n[_].start,l=n[_].end)}return a=r.closestPointOnSegment(a,c,u),a=[a[1],a[0]],a.start=h,a.end=l,a}return null},_buildTree:function(){var t=this._feature.geometry.coordinates,e=[];this._tree?this._tree.clear():this._tree=h();for(var i=1,n=t.length;n>i;i++){var r=this._toTreeNode(t[i-1],t[i]);r.start=i-1,r.end=i,e.push(r)}this._tree.load(e)},_toTreeNode:function(t,e){var i=t[0],n=e[0],r=t[1],s=e[1];return i>n&&(n=t[0],i=e[0]),r>s&&(s=t[1],r=e[1]),[i,r,n,s]}});e.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./endpoint":3,"./geometry":4,"./marker":5,"./selection":7,leaflet:void 0,rbush:2}],7:[function(t,e){"use strict";var i=t("leaflet"),n=i.Polyline.extend({initialize:function(t,e,n){this._source=n,i.Polyline.prototype.initialize.call(this,t,e)},updatePathFromSource:function(t,e){this._originalPoints=this._source._originalPoints.slice(t,e+1),this._originalPoints.unshift(this._map.latLngToLayerPoint(this._latlngs[0])),this._originalPoints.push(this._map.latLngToLayerPoint(this._latlngs[this._latlngs.length-1])),this._updatePath()}});e.exports=n},{leaflet:void 0}]},{},[1])(1)});