!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self);var i=e;i=i.L||(i.L={}),i=i.Control||(i.Control={}),i.LineStringSelect=t()}}(function(){return function t(e,i,n){function s(o,a){if(!i[o]){if(!e[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(r)return r(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var _=i[o]={exports:{}};e[o][0].call(_.exports,function(t){var i=e[o][1][t];return s(i?i:t)},_,_.exports,t,e,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t,e){(function(i){/**
 * Leaflet LineString selection control
 * @license MIT
 * @author Alexander Milevski <info@w8r.name>
 * @preserve
 */
var n=i.L||t("leaflet");n.Control.LineStringSelect=e.exports=t("./src/select")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/select":5,leaflet:void 0}],2:[function(t,e){"use strict";var i=t("./marker"),n=i.extend({options:{radiusRatio:1.2},onAdd:function(t){this.on("mouseover",this._onMouseOver,this).on("mouseout",this._onMouseOut,this),i.prototype.onAdd.call(this,t)},onRemove:function(t){this.off("mouseover",this._onMouseOver,this).off("mouseout",this._onMouseOut,this),i.prototype.onRemove.call(this,t)},_onMouseOver:function(){this.setRadius(this.options.radius*this.options.radiusRatio)},_onMouseOut:function(){this.setRadius(this.options.radius/this.options.radiusRatio)}});e.exports=n},{"./marker":4}],3:[function(t,e){"use strict";function i(t,e){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function n(t,e,n){var s=n[0]-e[0],r=n[1]-e[1],o=s*s+r*r,a=o&&((t[0]-e[0])*s+(t[1]-e[1])*(n[1]-e[1]))/o;return i(t,0>=a?e:a>=1?n:[e[0]+a*s,e[1]+a*r])}function s(t,e,i){var n=i[0]-e[0],s=i[1]-e[1],r=t[0]-e[0],o=t[1]-e[1];return(r*n+o*s)/(n*n+s*s)}function r(t,e,i){var n=s(t,e,i),r=i[0]-e[0],o=i[1]-e[1],a=[e[0]+n*r,e[1]+n*o];return a}function o(t,e,i){return t+i*(e-t)}function a(t,e,i,n){var s=i/n;return[o(t[0],e[0],s),o(t[1],e[1],s)]}e.exports={pointSegmentDistance:n,closestPointOnSegment:r,pointOnSegment:a}},{}],4:[function(t,e){"use strict";var i=t("leaflet"),n=i.CircleMarker.extend({show:function(){return this._container.style.visibility="",this},hide:function(){return this._container.style.visibility="hidden",this}});e.exports=n},{leaflet:void 0}],5:[function(t,e){(function(i){"use strict";var n=i.L||t("leaflet"),s=t("./geometry"),r=t("./marker"),o=t("./endpoint"),a=t("./selection"),l=i.rbush||t("rbush"),h=n.Control.extend({includes:n.Mixin.Events,options:{startMarkerClass:"select-marker select-start-marker",endMarkerClass:"select-marker select-end-marker",movingMarkerClass:"select-marker select-moving-marker",name:"leaflet-linestring-select",lineWeight:4,lineTolerance:5,movingMarkerStyle:{fillColor:"#fff",fillOpacity:1,weight:2,opacity:.5,color:"#000"},endpointStyle:{radius:5,color:"#111",fillColor:"#fff",fillOpacity:1},selectionStyle:{color:"#0ff",opacity:1},position:"topright"},initialize:function(t){t=t||{},this._startMarker=null,this._endMarker=null,this._movingMarker=null,this._feature=null,this._layer=null,this._selection=null,this._tolerance=null,n.Util.setOptions(this,t),n.Control.prototype.initialize.call(this,this.options)},onAdd:function(){var t=this._container=n.DomUtil.create("div",this.options.containerClass);return n.DomEvent.disableClickPropagation(t).disableScrollPropagation(t),t},onRemove:function(){},enable:function(t){return this._layer=t.layer,this._feature=t.feature||t.layer.toGeoJSON(),this._createHandles(),this._buildTree(),this._layer.on("click",this._onLayerClick,this),this._map.on("moveend zoomend resize",this._calculatePointerTolerance,this),this._map.on("mousemove",this._onMousemove,this).on("mousedown",this._onMouseDown,this).on("click",this._onMapClick,this),this._calculatePointerTolerance(),this},disable:function(){return this.reset(),this._map.removeLayer(this._movingMarker),this._movingMarker=null,this._layer.off("click",this._onLayerClick,this),this._map.off("moveend zoomend resize",this._calculatePointerTolerance,this),this._map.off("mousemove",this._onMousemove,this).off("mousedown",this._onMouseDown,this).off("click",this._onMapClick,this),this._feature=null,this._layer=null,this},reset:function(){return this._startMarker&&(this._map.removeLayer(this._startMarker),this._startMarker=null),this._endMarker&&(this._map.removeLayer(this._endMarker),this._endMarker=null),this._selection&&(this._map.removeLayer(this._selection),this._selection=null),this._movingMarker.setLatLng(this._layer.getLatLngs()[0]).show(),this},getSelection:function(){return this._selection?this._selection.getLatLngs():null},toGeoJSON:function(){return this._selection?this._selection.toGeoJSON():null},selectMeters:function(t,e){if(this.reset(),0>t||0>e)throw new Error("Can't use negative meter values for distance selection");var i=this._pointAtM(t),n=this._pointAtM(e);return i=this._getNearestPoint(i),n=this._getNearestPoint(n),this._setPoint(i,i.start,i.end),this._setPoint(n,n.start,n.end),this},_distance:function(t,e){return this.options.distance?this.options.distance(t,e):new n.LatLng(t[1],t[0]).distanceTo(new n.LatLng(e[1],e[0]))},_getProjectedPoint:function(t){return this.options.getProjectedPoint?this.options.getProjectedPoint.call(this,t):(t=this._map.options.crs.latLngToPoint(new n.LatLng(t[1],t[0]),this._map.getMaxZoom()),[t.x,t.y])},_pointAtSegmentM:function(t,e,i){t=this._getProjectedPoint(t),e=this._getProjectedPoint(e);var r=this._distance(t,e),o=s.pointOnSegment(t,e,i,r);return n.point(o)},_pointAtM:function(t){for(var e,i=this._feature.geometry.coordinates,s=0,r=1,o=i.length;o>r;r++){var a=this._distance(i[r-1],i[r]);if(!(t>=s+a))break;s+=a}return s===t||r===i.length?(e=i[r-1],new n.LatLng(e[1],e[0])):(e=this._pointAtSegmentM(i[r-1],i[r],t-s),this._map.options.crs.pointToLatLng(e,this._map.getMaxZoom()))},_calculatePointerTolerance:function(){var t=this._map.getCenter(),e=.5*this.options.lineWeight+this.options.lineTolerance,i=this._map.layerPointToLatLng(this._map.latLngToLayerPoint(t).add(new n.Point(e,e)));this._tolerance=new n.LatLng(Math.abs(t.lat-i.lat),Math.abs(t.lng-i.lng))},_createHandles:function(){var t=n.latLng(this._layer._latlngs[0]),e=this.options.movingMarkerStyle;e.radius=this.options.lineTolerance,e.className=this.options.movingMarkerClass,this._movingMarker=new r(t,e).addTo(this._map),this._movingMarker.on("click",this._onMovingMarkerClick,this)},_onMovingMarkerClick:function(){this._setPoint(this._movingMarker.getLatLng(),this._movingMarker.start,this._movingMarker.end)},_onLayerClick:function(t){var e=this._getNearestPoint(t.latlng);e?this._setPoint(n.latLng(e),e.start,e.end):this._setPoint(t.latlng)},_onMapClick:function(t){if(!this._endMarker){var e=this._map.latLngToLayerPoint(t.latlng),i=this._movingMarker.getLatLng(),n=this._map.latLngToLayerPoint(i),s=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2));s<=2*this.options.lineTolerance&&(i=this._getNearestPoint(i),this._setPoint(i,i.start,i.end))}},_setPoint:function(t,e,i){var n=this.options.endpointStyle;this._startMarker?this._endMarker||(n.className=this.options.endMarkerClass,this._endMarker=new o(t,n).addTo(this._map),this._endMarker.start=e,this._endMarker.end=i,this._movingMarker.hide(),this.fire("select:end",{latlng:t}),this._onSelect()):(n.className=this.options.startMarkerClass,this._startMarker=new o(t,n).addTo(this._map),this._startMarker.start=e,this._startMarker.end=i,this.fire("select:start",{latlng:t}))},_getPointerBounds:function(t){var e=this._tolerance.lng,i=this._tolerance.lat;return[[t.lat-i,t.lng-e],[t.lat+i,t.lng+e]]},_onMouseDown:function(t){var e=t.originalEvent.target||t.originalEvent.srcElement;this._startMarker&&this._startMarker._path===e?(this._dragging=this._startMarker,this._static=this._endMarker):this._endMarker&&this._endMarker._path===e&&(this._dragging=this._endMarker,this._static=this._startMarker),this._dragging&&(n.DomEvent.stop(t),this._dragging._dragging=!0,this._map.dragging.disable(),this._map.once("mouseup",this._stopHandlerDrag,this))},_stopHandlerDrag:function(t){this._dragging&&(i.clearTimeout(this._dragTimer),this._map.dragging.enable(),this._dragging._dragging=null,this._dragging=null,this._onDragStopped(this._dragging,t.latlng))},_onDragStopped:function(){this._onSelect()},_checkEndPoints:function(){if(this._startMarker.start>this._endMarker.start){var t=this._startMarker;this._startMarker=this._endMarker,this._endMarker=t}},_onSelect:function(){this._checkEndPoints();var t=this._startMarker.end,e=this._endMarker.start,i=this._layer._latlngs.slice(t,e+1);i.unshift(this._startMarker.getLatLng()),i.push(this._endMarker.getLatLng()),this._selection?(this._selection._latlngs=i,this._selection.updatePathFromSource(this._startMarker.end,this._endMarker.start)):(this._selection=new a(i,this.options.selectionStyle,this._layer).addTo(map),this._startMarker.bringToFront(),this._endMarker.bringToFront()),this.fire("selection")},_onMousemove:function(t){var e=this._getNearestPoint(t.latlng);this._dragging?(e&&(this._dragging.start=e.start,this._dragging.end=e.end,this._dragging.setLatLng(e)),this._startMarker&&this._endMarker&&this._onSelect(),i.clearTimeout(this._dragTimer),this._dragTimer=i.setTimeout(this._stopHandlerDrag.bind(this,t),750)):e&&(this._movingMarker.setLatLng(e),this._movingMarker.start=e.start,this._movingMarker.end=e.end)},_getNearestPoint:function(t,e){var i=this._getPointerBounds(t,e),n=(this._map,this._tree.search(this._toTreeNode(i[0].reverse(),i[1].reverse())));if(0!==n.length){var r=this._feature.geometry.coordinates,o=Number.MAX_VALUE,a=[t.lng,t.lat],l=n[0].start,h=n[0].end,_=r[l],c=r[h];if(n.length>1)for(var u=0,g=n.length;g>u;u++){var d=(n[u],r[n[u].start]),f=r[n[u].end],p=s.pointSegmentDistance(a,d,f);o>p&&(o=p,_=d,c=f,l=n[u].start,h=n[u].end)}return a=s.closestPointOnSegment(a,_,c),a=[a[1],a[0]],a.start=l,a.end=h,a}return null},_buildTree:function(){var t=this._feature.geometry.coordinates,e=[];this._tree?this._tree.clear():this._tree=l();for(var i=1,n=t.length;n>i;i++){var s=this._toTreeNode(t[i-1],t[i]);s.start=i-1,s.end=i,e.push(s)}this._tree.load(e)},_toTreeNode:function(t,e){var i=t[0],n=e[0],s=t[1],r=e[1];return i>n&&(n=t[0],i=e[0]),s>r&&(r=t[1],s=e[1]),[i,s,n,r]}});e.exports=h}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./endpoint":2,"./geometry":3,"./marker":4,"./selection":6,leaflet:void 0,rbush:void 0}],6:[function(t,e){"use strict";var i=t("leaflet"),n=i.Polyline.extend({initialize:function(t,e,n){this._source=n,i.Polyline.prototype.initialize.call(this,t,e)},updatePathFromSource:function(t,e){this._originalPoints=this._source._originalPoints.slice(t,e+1),this._originalPoints.unshift(this._map.latLngToLayerPoint(this._latlngs[0])),this._originalPoints.push(this._map.latLngToLayerPoint(this._latlngs[this._latlngs.length-1])),this._updatePath()}});e.exports=n},{leaflet:void 0}]},{},[1])(1)});