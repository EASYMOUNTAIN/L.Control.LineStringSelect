/*
 MIT
 @author Alexander Milevski <info@w8r.name>
 @preserve
*/
(function(q){if("object"===typeof exports&&"undefined"!==typeof module)module.exports=q();else if("function"===typeof define&&define.T)define([],q);else{var b;b="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this;b=b.L||(b.L={});b=b.Control||(b.Control={});b.LineStringSelect=q()}})(function(){return function b(h,g,c){function f(e,k){if(!g[e]){if(!h[e]){var l="function"==typeof require&&require;if(!k&&l)return l(e,!0);if(m)return m(e,!0);l=Error("Cannot find module '"+
e+"'");throw l.code="MODULE_NOT_FOUND",l;}l=g[e]={exports:{}};h[e][0].call(l.exports,function(a){var d=h[e][1][a];return f(d?d:a)},l,l.exports,b,h,g,c)}return g[e].exports}for(var m="function"==typeof require&&require,e=0;e<c.length;e++)f(c[e]);return f}({1:[function(b,h){(("undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{}).L||b("leaflet")).Control.LineStringSelect=h.exports=b("./src/select")},{"./src/select":5,leaflet:void 0}],2:[function(b,h){var g=
b("./marker"),c=g.extend({options:{radiusRatio:1.2},onAdd:function(c){this.on("mouseover",this.B,this).on("mouseout",this.A,this);g.prototype.onAdd.call(this,c)},onRemove:function(c){this.off("mouseover",this.B,this).off("mouseout",this.A,this);g.prototype.onRemove.call(this,c)},B:function(){this.setRadius(this.options.radius*this.options.radiusRatio)},A:function(){this.setRadius(this.options.radius/this.options.radiusRatio)}});h.exports=c},{"./marker":4}],3:[function(b,h){function g(c,f){var b=c[0]-
f[0],e=c[1]-f[1];return b*b+e*e}h.exports={R:function(c,f,b){var e=b[0]-f[0],h=b[1]-f[1],k=e*e+h*h,k=k&&((c[0]-f[0])*e+(c[1]-f[1])*(b[1]-f[1]))/k;return g(c,0>=k?f:1<=k?b:[f[0]+k*e,f[1]+k*h])},closestPointOnSegment:function(c,f,b){var e=b[0]-f[0],g=b[1]-f[1];c=((c[0]-f[0])*e+(c[1]-f[1])*g)/(e*e+g*g);c=0>c?0:1<c?1:c;return[f[0]+c*(b[0]-f[0]),f[1]+c*(b[1]-f[1])]},P:function(c,b,g,e){g/=e;e=c[0];c=c[1];return[e+g*(b[0]-e),c+g*(b[1]-c)]},distance:function(c,b){return Math.sqrt(g(c,b))}}},{}],4:[function(b,
h){(function(g){g=(g.L||b("leaflet")).CircleMarker.extend({show:function(){this._container.style.visibility="";return this},hide:function(){this._container.style.visibility="hidden";return this}});h.exports=g}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}],5:[function(b,h){(function(g){var c=g.L||b("leaflet"),f=b("./geometry"),m=b("./marker"),e=b("./endpoint"),p=b("./selection"),k=g.V||b("rbush"),l=c.Control.extend({includes:c.Mixin.Events,
statics:{Selection:p,Endpoint:e,ControlMarker:m},options:{startMarkerClass:"select-marker select-start-marker",endMarkerClass:"select-marker select-end-marker",movingMarkerClass:"select-marker select-moving-marker",name:"leaflet-linestring-select",lineWeight:4,lineTolerance:c.Browser.touch?10:5,movingMarkerStyle:{fillColor:"#fff",fillOpacity:1,weight:2,opacity:.5,color:"#000"},endpointStyle:{radius:5,color:"#111",fillColor:"#fff",fillOpacity:1},selectionStyle:{color:"#0ff",opacity:1},useTouch:c.Browser.touch,
position:"topright"},initialize:function(a){a=a||{};this.l=this.b=this.c=this._feature=this._movingMarker=this._endMarker=this._startMarker=null;c.Util.setOptions(this,a);c.Control.prototype.initialize.call(this,this.options)},onAdd:function(){var a=this._container=c.DomUtil.create("div",this.options.U);c.DomEvent.disableClickPropagation(a).disableScrollPropagation(a);return a},onRemove:function(){this.disable()},enable:function(a){this.c=a.layer;this._feature=a.feature||a.layer.toGeoJSON();this.J();
this.H();this.c.on("click",this.u,this);this._map.on("moveend zoomend resize",this.i,this).on("mousemove touchmove",this.C,this).on(c.Draggable.START.join(" "),this.w,this).on("click contextmenu",this.v,this);this.i();return this},disable:function(){this.reset();this._map.removeLayer(this._movingMarker);this._movingMarker=null;this.c.off("click",this.u,this);this._map.off("moveend zoomend resize",this.i,this).off("mousemove touchmove",this.C,this).off(c.Draggable.START.join(" "),this.w,this).off("click contextmenu",
this.v,this);this.c=this._feature=null;return this},reset:function(){this._startMarker&&(this._map.removeLayer(this._startMarker),this._startMarker=null);this._endMarker&&(this._map.removeLayer(this._endMarker),this._endMarker=null);this.b&&(this._map.removeLayer(this.b),this.b=null);this._movingMarker.setLatLng(this.c.getLatLngs()[0]);this.options.useTouch||this._movingMarker.show();this.fire("reset");return this},getSelection:function(){return this.b?this.b.getLatLngs():null},toGeoJSON:function(){return this.b?
this.b.toGeoJSON():null},selectMeters:function(a,d){this.reset();if(0>a||0>d)throw Error("Can't use negative meter values for distance selection");var c=this.D(a),b=this.D(d),c=this.f(c),b=this.f(b);this.g(c,c.start,c.end);this.g(b,b.start,b.end);return this},movingMarkerFactory:function(a,d){return new m(a,d)},endpointFactory:function(a,d){return new e(a,d)},selectionFactory:function(a,d,c){return new p(a,d,c)},m:function(a,d){return this.options.distance?this.options.distance(a,d):(new c.LatLng(a[1],
a[0])).distanceTo(new c.LatLng(d[1],d[0]))},s:function(a){if(this.options.getProjectedPoint)return this.options.getProjectedPoint.call(this,a);a=this._map.options.crs.latLngToPoint(new c.LatLng(a[1],a[0]),this._map.getMaxZoom());return[a.x,a.y]},O:function(a,d,v){var b=this.m(a,d);a=this.s(a);d=this.s(d);a=f.P(a,d,v,b);return c.point(a)},D:function(a){for(var d=this._feature.geometry.coordinates,b=0,f=1,e=d.length;f<e;f++){var g=this.m(d[f-1],d[f]);if(b+g<=a)b+=g;else break}if(b===a||f===d.length)return a=
d[f-1],new c.LatLng(a[1],a[0]);a=this.O(d[f-1],d[f],a-b);return this._map.options.crs.pointToLatLng(a,this._map.getMaxZoom())},i:function(){var a=this._map.getCenter(),d=.5*this.options.lineWeight+this.options.lineTolerance,d=this._map.layerPointToLatLng(this._map.latLngToLayerPoint(a).add(new c.Point(d,d)));this.l=new c.LatLng(Math.abs(a.lat-d.lat),Math.abs(a.lng-d.lng))},J:function(){var a=c.latLng(this.c._latlngs[0]),d=this.options.movingMarkerStyle;d.radius=this.options.lineTolerance;d.className=
this.options.movingMarkerClass;this._movingMarker=this.movingMarkerFactory(a,d).addTo(this._map);this._movingMarker.on("click",this.N,this);this.options.useTouch&&this._movingMarker.hide()},N:function(){this.g(this._movingMarker.getLatLng(),this._movingMarker.start,this._movingMarker.end)},u:function(a){var d=this.f(a.latlng);d?this.g(c.latLng(d),d.start,d.end):this.g(a.latlng)},v:function(a){if(!this._endMarker){var d=this._map.latLngToLayerPoint(a.latlng),b=this._movingMarker.getLatLng();this.options.useTouch&&
(a=this.f(a.latlng))&&(b=c.latLng(a),this._movingMarker.setLatLng(b));a=this._map.latLngToLayerPoint(b);f.distance([d.x,d.y],[a.x,a.y])<=2*this.options.lineTolerance&&(b=this.f(b),this.g(b,b.start,b.end))}},g:function(a,d,c){var b=this.options.endpointStyle;this._startMarker?this._endMarker||(b.className=this.options.endMarkerClass,this._endMarker=this.endpointFactory(a,b,!0).addTo(this._map),this._endMarker.start=d,this._endMarker.end=c,this._movingMarker.hide(),this.fire("select:end",{latlng:a}),
this._startMarker&&this._endMarker&&this.j()):(b.className=this.options.startMarkerClass,this._startMarker=this.endpointFactory(a,b,!1).addTo(this._map),this._startMarker.start=d,this._startMarker.end=c,this.fire("select:start",{latlng:a}))},K:function(a){var d=this.l.lng,b=this.l.lat;return[[a.lat-b,a.lng-d],[a.lat+b,a.lng+d]]},w:function(a){var d=a.originalEvent.target||a.originalEvent.srcElement;if(this.options.useTouch){var b;this._startMarker&&(b=this._map.latLngToContainerPoint(this._startMarker.getLatLng()),
f.distance([a.containerPoint.x,a.containerPoint.y],[b.x,b.y])<=2*this.options.lineTolerance&&(d=this._startMarker._path));this._endMarker&&(b=this._map.latLngToContainerPoint(this._endMarker.getLatLng()),f.distance([a.containerPoint.x,a.containerPoint.y],[b.x,b.y])<=2*this.options.lineTolerance&&(d=this._endMarker._path))}this._startMarker&&this._startMarker._path===d?this.a=this._startMarker:this._endMarker&&this._endMarker._path===d&&(this.a=this._endMarker);this.a&&(c.DomEvent.stop(a),this.a.a=
!0,c.Draggable._disabled=!0,this._map.dragging.disable(),this._map.once("mouseup",this.F,this))},F:function(a){this.a&&(g.clearTimeout(this.o),c.Draggable._disabled=!1,this._map.dragging.enable(),this.a=this.a.a=null,this.M(this.a,a.latlng))},M:function(){this._startMarker&&this._endMarker&&this.j()},I:function(){if(this._startMarker.start>this._endMarker.start){var a=this._startMarker;this._startMarker=this._endMarker;this._endMarker=a}},j:function(){this.I();var a=this.c._latlngs.slice(this._startMarker.end,
this._endMarker.start+1);a.unshift(this._startMarker.getLatLng());a.push(this._endMarker.getLatLng());this.b?(this.b._latlngs=a,this.b.S(this._startMarker.end,this._endMarker.start)):(this.b=this.selectionFactory(a,this.options.selectionStyle,this.c).addTo(this._map),this._startMarker.bringToFront(),this._endMarker.bringToFront());this.fire("selection")},C:function(a){var b=this.f(a.latlng);this.a?(b&&(this.a.start=b.start,this.a.end=b.end,this.a.setLatLng(b)),this._startMarker&&this._endMarker&&
this.j(),g.clearTimeout(this.o),this.o=g.setTimeout(this.F.bind(this,a),750)):b&&(this._movingMarker.setLatLng(b),this._movingMarker.start=b.start,this._movingMarker.end=b.end)},f:function(a,b){var c=this.K(a,b),c=this.h.search(this.G(c[0].reverse(),c[1].reverse()));if(0!==c.length){var e=this._feature.geometry.coordinates,g=Number.MAX_VALUE,h=[a.lng,a.lat],k=c[0].start,l=c[0].end,m=e[k],p=e[l];if(1<c.length)for(var n=0,w=c.length;n<w;n++){var r=e[c[n].start],t=e[c[n].end],u=f.R(h,r,t);u<g&&(g=u,
m=r,p=t,k=c[n].start,l=c[n].end)}h=f.closestPointOnSegment(h,m,p);h=[h[1],h[0]];h.start=k;h.end=l;return h}return null},H:function(){var a=this._feature.geometry.coordinates,b=[];this.h?this.h.clear():this.h=k();for(var c=1,f=a.length;c<f;c++){var e=this.G(a[c-1],a[c]);e.start=c-1;e.end=c;b.push(e)}this.h.load(b)},G:function(a,b){var c=a[0],f=b[0],e=a[1],g=b[1];c>f&&(f=a[0],c=b[0]);e>g&&(g=a[1],e=b[1]);return[c,e,f,g]}});h.exports=l}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?
self:"undefined"!==typeof window?window:{})},{"./endpoint":2,"./geometry":3,"./marker":4,"./selection":6,leaflet:void 0,rbush:void 0}],6:[function(b,h){(function(g){var c=g.L||b("leaflet");g=c.Polyline.extend({initialize:function(b,g,e){this._source=e;c.Polyline.prototype.initialize.call(this,b,g)},S:function(b,c){this._originalPoints=this._source._originalPoints.slice(b,c+1);this._originalPoints.unshift(this._map.latLngToLayerPoint(this._latlngs[0]));this._originalPoints.push(this._map.latLngToLayerPoint(this._latlngs[this._latlngs.length-
1]));this._updatePath()}});h.exports=g}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}]},{},[1])(1)});
