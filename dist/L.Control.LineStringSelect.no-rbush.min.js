/*
 MIT
 @author Alexander Milevski <info@w8r.name>
 @preserve
*/
function n(){return function k(g,e,b){function d(f,p){if(!e[f]){if(!g[f]){var m="function"==typeof require&&require;if(!p&&m)return m(f,!0);if(l)return l(f,!0);m=Error("Cannot find module '"+f+"'");throw m.code="MODULE_NOT_FOUND",m;}m=e[f]={exports:{}};g[f][0].call(m.exports,function(a){var c=g[f][1][a];return d(c?c:a)},m,m.exports,k,g,e,b)}return e[f].exports}for(var l="function"==typeof require&&require,f=0;f<b.length;f++)d(b[f]);return d}({1:[function(k,g){(("undefined"!==typeof global?global:
"undefined"!==typeof self?self:"undefined"!==typeof window?window:{}).L||k("leaflet")).Control.LineStringSelect=g.exports=k("./src/select")},{"./src/select":5,leaflet:void 0}],2:[function(k,g){var e=k("./marker"),b=e.extend({options:{radiusRatio:1.2},onAdd:function(b){this.on("mouseover",this.q,this).on("mouseout",this.p,this);e.prototype.onAdd.call(this,b)},onRemove:function(b){this.off("mouseover",this.q,this).off("mouseout",this.p,this);e.prototype.onRemove.call(this,b)},q:function(){this.setRadius(this.options.radius*
this.options.radiusRatio)},p:function(){this.setRadius(this.options.radius/this.options.radiusRatio)}});g.exports=b},{"./marker":4}],3:[function(k,g){function e(b,d){var l=b[0]-d[0],f=b[1]-d[1];return l*l+f*f}g.exports={H:function(b,d,l){var f=l[0]-d[0],k=l[1]-d[1],g=f*f+k*k,g=g&&((b[0]-d[0])*f+(b[1]-d[1])*(l[1]-d[1]))/g;return e(b,0>=g?d:1<=g?l:[d[0]+g*f,d[1]+g*k])},closestPointOnSegment:function(b,d,l){var f=l[0]-d[0],e=l[1]-d[1];b=((b[0]-d[0])*f+(b[1]-d[1])*e)/(f*f+e*e);return[d[0]+b*(l[0]-d[0]),
d[1]+b*(l[1]-d[1])]},G:function(b,d,e,f){e/=f;f=b[0];b=b[1];return[f+e*(d[0]-f),b+e*(d[1]-b)]},distance:function(b,d){return Math.sqrt(e(b,d))}}},{}],4:[function(k,g){(function(e){e=(e.L||k("leaflet")).CircleMarker.extend({show:function(){this._container.style.visibility="";return this},hide:function(){this._container.style.visibility="hidden";return this}});g.exports=e}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}],
5:[function(k,g){(function(e){var b=e.L||k("leaflet"),d=k("./geometry"),l=k("./marker"),f=k("./endpoint"),r=k("./selection"),p=e.M||k("rbush"),m=b.Control.extend({includes:b.Mixin.Events,statics:{Selection:r,Endpoint:f,ControlMarker:l},options:{startMarkerClass:"select-marker select-start-marker",endMarkerClass:"select-marker select-end-marker",movingMarkerClass:"select-marker select-moving-marker",name:"leaflet-linestring-select",lineWeight:4,lineTolerance:b.Browser.touch?10:5,movingMarkerStyle:{fillColor:"#fff",
fillOpacity:1,weight:2,opacity:.5,color:"#000"},endpointStyle:{radius:5,color:"#111",fillColor:"#fff",fillOpacity:1},selectionStyle:{color:"#0ff",opacity:1},useTouch:b.Browser.touch,position:"topright"},initialize:function(a){a=a||{};this.i=this.b=this.c=this._feature=this._movingMarker=this._endMarker=this._startMarker=null;b.Util.setOptions(this,a);b.Control.prototype.initialize.call(this,this.options)},onAdd:function(){var a=this._container=b.DomUtil.create("div",this.options.K);b.DomEvent.disableClickPropagation(a).disableScrollPropagation(a);
return a},onRemove:function(){this.disable()},enable:function(a){this.c=a.layer;this._feature=a.feature||a.layer.toGeoJSON();this.A();this.v();this.c.on("click",this.m,this);this._map.on("moveend zoomend resize",this.g,this).on("mousemove touchmove",this.r,this).on(b.Draggable.START.join(" "),this.o,this).on("click contextmenu",this.n,this);this.g();return this},disable:function(){this.reset();this._map.removeLayer(this._movingMarker);this._movingMarker=null;this.c.off("click",this.m,this);this._map.off("moveend zoomend resize",
this.g,this).off("mousemove touchmove",this.r,this).off(b.Draggable.START.join(" "),this.o,this).off("click contextmenu",this.n,this);this.c=this._feature=null;return this},reset:function(){this._startMarker&&(this._map.removeLayer(this._startMarker),this._startMarker=null);this._endMarker&&(this._map.removeLayer(this._endMarker),this._endMarker=null);this.b&&(this._map.removeLayer(this.b),this.b=null);this._movingMarker.setLatLng(this.c.getLatLngs()[0]);this.options.useTouch||this._movingMarker.show();
this.fire("reset");return this},getSelection:function(){return this.b?this.b.getLatLngs():null},toGeoJSON:function(){return this.b?this.b.toGeoJSON():null},selectMeters:function(a,c){this.reset();if(0>a||0>c)throw Error("Can't use negative meter values for distance selection");var h=this.s(a),b=this.s(c),h=this.d(h),b=this.d(b);this.e(h,h.start,h.end);this.e(b,b.start,b.end);return this},movingMarkerFactory:function(a,c){return new l(a,c)},endpointFactory:function(a,c){return new f(a,c)},selectionFactory:function(a,
c,b){return new r(a,c,b)},j:function(a,c){return this.options.distance?this.options.distance(a,c):(new b.LatLng(a[1],a[0])).distanceTo(new b.LatLng(c[1],c[0]))},l:function(a){if(this.options.getProjectedPoint)return this.options.getProjectedPoint.call(this,a);a=this._map.options.crs.latLngToPoint(new b.LatLng(a[1],a[0]),this._map.getMaxZoom());return[a.x,a.y]},F:function(a,c,h){var f=this.j(a,c);a=this.l(a);c=this.l(c);a=d.G(a,c,h,f);return b.point(a)},s:function(a){for(var c=this._feature.geometry.coordinates,
h=0,d=1,f=c.length;d<f;d++){var e=this.j(c[d-1],c[d]);if(h+e<=a)h+=e;else break}if(h===a||d===c.length)return a=c[d-1],new b.LatLng(a[1],a[0]);a=this.F(c[d-1],c[d],a-h);return this._map.options.crs.pointToLatLng(a,this._map.getMaxZoom())},g:function(){var a=this._map.getCenter(),c=.5*this.options.lineWeight+this.options.lineTolerance,c=this._map.layerPointToLatLng(this._map.latLngToLayerPoint(a).add(new b.Point(c,c)));this.i=new b.LatLng(Math.abs(a.lat-c.lat),Math.abs(a.lng-c.lng))},A:function(){var a=
b.latLng(this.c._latlngs[0]),c=this.options.movingMarkerStyle;c.radius=this.options.lineTolerance;c.className=this.options.movingMarkerClass;this._movingMarker=this.movingMarkerFactory(a,c).addTo(this._map);this._movingMarker.on("click",this.D,this);this.options.useTouch&&this._movingMarker.hide()},D:function(){this.e(this._movingMarker.getLatLng(),this._movingMarker.start,this._movingMarker.end)},m:function(a){var c=this.d(a.latlng);c?this.e(b.latLng(c),c.start,c.end):this.e(a.latlng)},n:function(a){if(!this._endMarker){var c=
this._map.latLngToLayerPoint(a.latlng),h=this._movingMarker.getLatLng();this.options.useTouch&&(a=this.d(a.latlng))&&(h=b.latLng(a),this._movingMarker.setLatLng(h));a=this._map.latLngToLayerPoint(h);d.distance([c.x,c.y],[a.x,a.y])<=2*this.options.lineTolerance&&(h=this.d(h),this.e(h,h.start,h.end))}},e:function(a,c,b){var d=this.options.endpointStyle;this._startMarker?this._endMarker||(d.className=this.options.endMarkerClass,this._endMarker=this.endpointFactory(a,d,!0).addTo(this._map),this._endMarker.start=
c,this._endMarker.end=b,this._movingMarker.hide(),this.fire("select:end",{latlng:a}),this.h()):(d.className=this.options.startMarkerClass,this._startMarker=this.endpointFactory(a,d,!1).addTo(this._map),this._startMarker.start=c,this._startMarker.end=b,this.fire("select:start",{latlng:a}))},B:function(a){var c=this.i.lng,b=this.i.lat;return[[a.lat-b,a.lng-c],[a.lat+b,a.lng+c]]},o:function(a){var c=a.originalEvent.target||a.originalEvent.srcElement;if(this.options.useTouch){var h;this._startMarker&&
(h=this._map.latLngToContainerPoint(this._startMarker.getLatLng()),d.distance([a.containerPoint.x,a.containerPoint.y],[h.x,h.y])<=2*this.options.lineTolerance&&(c=this._startMarker._path));this._endMarker&&(h=this._map.latLngToContainerPoint(this._endMarker.getLatLng()),d.distance([a.containerPoint.x,a.containerPoint.y],[h.x,h.y])<=2*this.options.lineTolerance&&(c=this._endMarker._path))}this._startMarker&&this._startMarker._path===c?this.a=this._startMarker:this._endMarker&&this._endMarker._path===
c&&(this.a=this._endMarker);this.a&&(b.DomEvent.stop(a),this.a.a=!0,b.Draggable._disabled=!0,this._map.dragging.disable(),this._map.once("mouseup",this.t,this))},t:function(a){this.a&&(e.clearTimeout(this.k),b.Draggable._disabled=!1,this._map.dragging.enable(),this.a=this.a.a=null,this.C(this.a,a.latlng))},C:function(){this.h()},w:function(){if(this._startMarker.start>this._endMarker.start){var a=this._startMarker;this._startMarker=this._endMarker;this._endMarker=a}},h:function(){this.w();var a=this.c._latlngs.slice(this._startMarker.end,
this._endMarker.start+1);a.unshift(this._startMarker.getLatLng());a.push(this._endMarker.getLatLng());this.b?(this.b._latlngs=a,this.b.I(this._startMarker.end,this._endMarker.start)):(this.b=this.selectionFactory(a,this.options.selectionStyle,this.c).addTo(this._map),this._startMarker.bringToFront(),this._endMarker.bringToFront());this.fire("selection")},r:function(a){var c=this.d(a.latlng);this.a?(c&&(this.a.start=c.start,this.a.end=c.end,this.a.setLatLng(c)),this._startMarker&&this._endMarker&&
this.h(),e.clearTimeout(this.k),this.k=e.setTimeout(this.t.bind(this,a),750)):c&&(this._movingMarker.setLatLng(c),this._movingMarker.start=c.start,this._movingMarker.end=c.end)},d:function(a,c){var b=this.B(a,c),b=this.f.search(this.u(b[0].reverse(),b[1].reverse()));if(0!==b.length){var f=this._feature.geometry.coordinates,e=Number.MAX_VALUE,g=[a.lng,a.lat],k=b[0].start,l=b[0].end,m=f[k],p=f[l];if(1<b.length)for(var q=0,r=b.length;q<r;q++){var v=f[b[q].start],w=f[b[q].end],x=d.H(g,v,w);x<e&&(e=x,
m=v,p=w,k=b[q].start,l=b[q].end)}g=d.closestPointOnSegment(g,m,p);g=[g[1],g[0]];g.start=k;g.end=l;return g}return null},v:function(){var a=this._feature.geometry.coordinates,b=[];this.f?this.f.clear():this.f=p();for(var d=1,f=a.length;d<f;d++){var e=this.u(a[d-1],a[d]);e.start=d-1;e.end=d;b.push(e)}this.f.load(b)},u:function(a,b){var d=a[0],f=b[0],e=a[1],g=b[1];d>f&&(f=a[0],d=b[0]);e>g&&(g=a[1],e=b[1]);return[d,e,f,g]}});g.exports=m}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?
self:"undefined"!==typeof window?window:{})},{"./endpoint":2,"./geometry":3,"./marker":4,"./selection":6,leaflet:void 0,rbush:void 0}],6:[function(k,g){(function(e){var b=e.L||k("leaflet");e=b.Polyline.extend({initialize:function(d,e,f){this._source=f;b.Polyline.prototype.initialize.call(this,d,e)},I:function(b,e){this._originalPoints=this._source._originalPoints.slice(b,e+1);this._originalPoints.unshift(this._map.latLngToLayerPoint(this._latlngs[0]));this._originalPoints.push(this._map.latLngToLayerPoint(this._latlngs[this._latlngs.length-
1]));this._updatePath()}});g.exports=e}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}]},{},[1])(1)}
if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.J)define([],n);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self);var u=t,u=u.L||(u.L={}),u=u.Control||(u.Control={});u.LineStringSelect=n()}!0;
