/*
 MIT
 @author Alexander Milevski <info@w8r.name>
 @preserve
*/
(function(q){if("object"===typeof exports&&"undefined"!==typeof module)module.exports=q();else if("function"===typeof define&&define.T)define([],q);else{var b;b="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this;b=b.L||(b.L={});b=b.Control||(b.Control={});b.LineStringSelect=q()}})(function(){return function b(h,d,c){function f(g,k){if(!d[g]){if(!h[g]){var l="function"==typeof require&&require;if(!k&&l)return l(g,!0);if(m)return m(g,!0);l=Error("Cannot find module '"+
g+"'");throw l.code="MODULE_NOT_FOUND",l;}l=d[g]={exports:{}};h[g][0].call(l.exports,function(a){var e=h[g][1][a];return f(e?e:a)},l,l.exports,b,h,d,c)}return d[g].exports}for(var m="function"==typeof require&&require,g=0;g<c.length;g++)f(c[g]);return f}({1:[function(b,h){(("undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{}).L||b("leaflet")).Control.LineStringSelect=h.exports=b("./src/select")},{"./src/select":5,leaflet:void 0}],2:[function(b,h){var d=
b("./marker"),c=d.extend({options:{radiusRatio:1.2},onAdd:function(c){this.on("mouseover",this.B,this).on("mouseout",this.A,this);d.prototype.onAdd.call(this,c)},onRemove:function(c){this.off("mouseover",this.B,this).off("mouseout",this.A,this);d.prototype.onRemove.call(this,c)},B:function(){this.setRadius(this.options.radius*this.options.radiusRatio)},A:function(){this.setRadius(this.options.radius/this.options.radiusRatio)}});h.exports=c},{"./marker":4}],3:[function(b,h){function d(c,f){var b=c[0]-
f[0],g=c[1]-f[1];return b*b+g*g}h.exports={R:function(c,f,b){var g=b[0]-f[0],h=b[1]-f[1],k=g*g+h*h,k=k&&((c[0]-f[0])*g+(c[1]-f[1])*(b[1]-f[1]))/k;return d(c,0>=k?f:1<=k?b:[f[0]+k*g,f[1]+k*h])},closestPointOnSegment:function(c,f,b){var g=b[0]-f[0],d=b[1]-f[1];c=((c[0]-f[0])*g+(c[1]-f[1])*d)/(g*g+d*d);c=0>c?0:1<c?1:c;return[f[0]+c*(b[0]-f[0]),f[1]+c*(b[1]-f[1])]},P:function(c,b,d,g){d/=g;g=c[0];c=c[1];return[g+d*(b[0]-g),c+d*(b[1]-c)]},distance:function(c,b){return Math.sqrt(d(c,b))}}},{}],4:[function(b,
h){(function(d){d=(d.L||b("leaflet")).CircleMarker.extend({show:function(){this._container.style.visibility="";return this},hide:function(){this._container.style.visibility="hidden";return this}});h.exports=d}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}],5:[function(b,h){(function(d){var c=d.L||b("leaflet"),f=b("./geometry"),m=b("./marker"),g=b("./endpoint"),p=b("./selection"),k=d.V||b("rbush"),l=c.Control.extend({includes:c.Mixin.Events,
statics:{Selection:p,Endpoint:g,ControlMarker:m},options:{startMarkerClass:"select-marker select-start-marker",endMarkerClass:"select-marker select-end-marker",movingMarkerClass:"select-marker select-moving-marker",name:"leaflet-linestring-select",lineWeight:4,lineTolerance:c.Browser.touch?10:5,movingMarkerStyle:{fillColor:"#fff",fillOpacity:1,weight:2,opacity:.5,color:"#000"},endpointStyle:{radius:5,color:"#111",fillColor:"#fff",fillOpacity:1},selectionStyle:{color:"#0ff",opacity:1},useTouch:c.Browser.touch,
position:"topright"},initialize:function(a){a=a||{};this.l=this.b=this.c=this._feature=this._movingMarker=this._endMarker=this._startMarker=null;c.Util.setOptions(this,a);c.Control.prototype.initialize.call(this,this.options)},onAdd:function(){var a=this._container=c.DomUtil.create("div",this.options.U);c.DomEvent.disableClickPropagation(a).disableScrollPropagation(a);return a},onRemove:function(){this.disable()},enable:function(a){this.c=a.layer;this._feature=a.feature||a.layer.toGeoJSON();this.J();
this.H();this.c.on("click",this.u,this);this._map.on("moveend zoomend resize",this.i,this).on("mousemove touchmove",this.C,this).on(c.Draggable.START.join(" "),this.w,this).on("click contextmenu",this.v,this);this.i();return this},disable:function(){this.reset();this._map.removeLayer(this._movingMarker);this._movingMarker=null;this.c.off("click",this.u,this);this._map.off("moveend zoomend resize",this.i,this).off("mousemove touchmove",this.C,this).off(c.Draggable.START.join(" "),this.w,this).off("click contextmenu",
this.v,this);this.c=this._feature=null;return this},reset:function(){this._startMarker&&(this._map.removeLayer(this._startMarker),this._startMarker=null);this._endMarker&&(this._map.removeLayer(this._endMarker),this._endMarker=null);this.b&&(this._map.removeLayer(this.b),this.b=null);this._movingMarker.setLatLng(this.c.getLatLngs()[0]);this.options.useTouch||this._movingMarker.show();this.fire("reset");return this},getSelection:function(){return this.b?this.b.getLatLngs():null},toGeoJSON:function(){return this.b?
this.b.toGeoJSON():null},selectMeters:function(a,e){this.reset();if(0>a||0>e)throw Error("Can't use negative meter values for distance selection");var c=this.D(a),b=this.D(e),c=this.f(c),b=this.f(b);this.g(c,c.start,c.end);this.g(b,b.start,b.end);return this},movingMarkerFactory:function(a,e){return new m(a,e)},endpointFactory:function(a,e){return new g(a,e)},selectionFactory:function(a,e,c){return new p(a,e,c)},m:function(a,e){return this.options.distance?this.options.distance(a,e):(new c.LatLng(a[1],
a[0])).distanceTo(new c.LatLng(e[1],e[0]))},s:function(a){if(this.options.getProjectedPoint)return this.options.getProjectedPoint.call(this,a);a=this._map.options.crs.latLngToPoint(new c.LatLng(a[1],a[0]),this._map.getMaxZoom());return[a.x,a.y]},O:function(a,e,v){var b=this.m(a,e);a=this.s(a);e=this.s(e);a=f.P(a,e,v,b);return c.point(a)},D:function(a){for(var e=this._feature.geometry.coordinates,b=0,f=1,g=e.length;f<g;f++){var d=this.m(e[f-1],e[f]);if(b+d<=a)b+=d;else break}if(b===a||f===e.length)return a=
e[f-1],new c.LatLng(a[1],a[0]);a=this.O(e[f-1],e[f],a-b);return this._map.options.crs.pointToLatLng(a,this._map.getMaxZoom())},i:function(){var a=this._map.getCenter(),e=.5*this.options.lineWeight+this.options.lineTolerance,e=this._map.layerPointToLatLng(this._map.latLngToLayerPoint(a).add(new c.Point(e,e)));this.l=new c.LatLng(Math.abs(a.lat-e.lat),Math.abs(a.lng-e.lng))},J:function(){var a=c.latLng(this.c._latlngs[0]),e=this.options.movingMarkerStyle;e.radius=this.options.lineTolerance;e.className=
this.options.movingMarkerClass;this._movingMarker=this.movingMarkerFactory(a,e).addTo(this._map);this._movingMarker.on("click",this.N,this);this.options.useTouch&&this._movingMarker.hide()},N:function(){this.g(this._movingMarker.getLatLng(),this._movingMarker.start,this._movingMarker.end)},u:function(a){var e=this.f(a.latlng);e?this.g(c.latLng(e),e.start,e.end):this.g(a.latlng)},v:function(a){if(!this._endMarker){var e=this._map.latLngToLayerPoint(a.latlng),b=this._movingMarker.getLatLng();this.options.useTouch&&
(a=this.f(a.latlng))&&(b=c.latLng(a),this._movingMarker.setLatLng(b));a=this._map.latLngToLayerPoint(b);f.distance([e.x,e.y],[a.x,a.y])<=2*this.options.lineTolerance&&(b=this.f(b),this.g(b,b.start,b.end))}},g:function(a,e,c){var b=this.options.endpointStyle;this._startMarker?this._endMarker||(b.className=this.options.endMarkerClass,this._endMarker=this.endpointFactory(a,b,!0).addTo(this._map),this._endMarker.start=e,this._endMarker.end=c,this._movingMarker.hide(),this.fire("select:end",{latlng:a}),
this._startMarker&&this._endMarker&&this.j()):(b.className=this.options.startMarkerClass,this._startMarker=this.endpointFactory(a,b,!1).addTo(this._map),this._startMarker.start=e,this._startMarker.end=c,this.fire("select:start",{latlng:a}))},K:function(a){var e=this.l.lng,b=this.l.lat;return[[a.lat-b,a.lng-e],[a.lat+b,a.lng+e]]},w:function(a){var b=a.originalEvent.target||a.originalEvent.srcElement;if(this.options.useTouch){var d;this._startMarker&&(d=this._map.latLngToContainerPoint(this._startMarker.getLatLng()),
f.distance([a.containerPoint.x,a.containerPoint.y],[d.x,d.y])<=2*this.options.lineTolerance&&(b=this._startMarker._path));this._endMarker&&(d=this._map.latLngToContainerPoint(this._endMarker.getLatLng()),f.distance([a.containerPoint.x,a.containerPoint.y],[d.x,d.y])<=2*this.options.lineTolerance&&(b=this._endMarker._path))}this._startMarker&&this._startMarker._path===b?this.a=this._startMarker:this._endMarker&&this._endMarker._path===b&&(this.a=this._endMarker);this.a&&(c.DomEvent.stop(a),this.a.a=
!0,c.Draggable._disabled=!0,this._map.dragging.disable(),this._map.once("mouseup",this.F,this))},F:function(a){this.a&&(d.clearTimeout(this.o),c.Draggable._disabled=!1,this._map.dragging.enable(),this.a=this.a.a=null,this.M(this.a,a.latlng))},M:function(){this._startMarker&&this._endMarker&&this.j()},I:function(){if(this._startMarker.start>this._endMarker.start){var a=this._startMarker;this._startMarker=this._endMarker;this._endMarker=a}},j:function(){this.I();var a=this.c._latlngs.slice(this._startMarker.end,
this._endMarker.start+1);a.unshift(this._startMarker.getLatLng());a.push(this._endMarker.getLatLng());this.b?(this.b._latlngs=a,this.b.S(this._startMarker.end,this._endMarker.start)):(this.b=this.selectionFactory(a,this.options.selectionStyle,this.c).addTo(this._map),this._startMarker.bringToFront(),this._endMarker.bringToFront());this.fire("selection")},C:function(a){var b=this.f(a.latlng);this.a?(b&&(this.a.start=b.start,this.a.end=b.end,this.a.setLatLng(b)),this._startMarker&&this._endMarker&&
this.j(),d.clearTimeout(this.o),this.o=d.setTimeout(this.F.bind(this,a),750)):b&&(this._movingMarker.setLatLng(b),this._movingMarker.start=b.start,this._movingMarker.end=b.end)},f:function(a,b){var c=this.K(a,b),c=this.h.search(this.G(c[0].reverse(),c[1].reverse()));if(0!==c.length){var d=this._feature.geometry.coordinates,g=Number.MAX_VALUE,h=[a.lng,a.lat],k=c[0].start,l=c[0].end,m=d[k],p=d[l];if(1<c.length)for(var n=0,w=c.length;n<w;n++){var r=d[c[n].start],t=d[c[n].end],u=f.R(h,r,t);u<g&&(g=u,
m=r,p=t,k=c[n].start,l=c[n].end)}h=f.closestPointOnSegment(h,m,p);h=[h[1],h[0]];h.start=k;h.end=l;return h}return null},H:function(){var a=this._feature.geometry.coordinates,b=[];this.h?this.h.clear():this.h=k();for(var c=1,d=a.length;c<d;c++){var f=this.G(a[c-1],a[c]);f.start=c-1;f.end=c;b.push(f)}this.h.load(b)},G:function(a,b){var c=a[0],d=b[0],f=a[1],g=b[1];c>d&&(d=a[0],c=b[0]);f>g&&(g=a[1],f=b[1]);return[c,f,d,g]}});h.exports=l}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?
self:"undefined"!==typeof window?window:{})},{"./endpoint":2,"./geometry":3,"./marker":4,"./selection":6,leaflet:void 0,rbush:void 0}],6:[function(b,h){(function(d){var c=d.L||b("leaflet");d=c.Polyline.extend({initialize:function(b,d,g){this._source=g;c.Polyline.prototype.initialize.call(this,b,d)},S:function(b,c){this._originalPoints=this._source._originalPoints.slice(b,c+1);this._originalPoints.unshift(this._map.latLngToLayerPoint(this._latlngs[0]));this._originalPoints.push(this._map.latLngToLayerPoint(this._latlngs[this._latlngs.length-
1]));this._updatePath()}});h.exports=d}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{leaflet:void 0}]},{},[1])(1)});
